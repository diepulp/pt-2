---
# EXECUTION-SPEC Frontmatter
# Generated by lead-architect, refined by domain experts

prd: PRD-024
prd_title: "Landing Page Overhaul + Start Gateway v0"
service: MarketingContext + OnboardingContext + AuthContext
mvp_phase: 1

# Workstream Definitions
workstreams:
  WS1:
    name: Database Migration
    description: Add setup_status and setup_completed_at to casino_settings with backfill
    executor: backend-service-builder
    executor_type: skill
    depends_on: []
    outputs:
      - supabase/migrations/20260201173234_prd024_casino_setup_status.sql
      - types/remote/database.types.ts
    gate: schema-validation
    estimated_complexity: low

  WS2:
    name: Middleware & Auth Updates
    description: Restore middleware, update public paths, re-enable layout guards, update all auth redirects
    executor: backend-service-builder
    executor_type: skill
    depends_on: []
    outputs:
      - middleware.ts
      - lib/supabase/middleware.ts
      - app/(dashboard)/layout.tsx
      - components/login-form.tsx
      - app/(public)/auth/confirm/route.ts
      - app/(dashboard)/pit/page.tsx
      - app/(dashboard)/compliance/page.tsx
      - app/protected/page.tsx
    gate: type-check
    estimated_complexity: medium

  WS3:
    name: Route Structure & Gateway
    description: Create (marketing), (onboarding) route groups, stub pages, /start gateway, marketing header/footer
    executor: frontend-design-pt-2
    executor_type: skill
    depends_on: [WS1]
    outputs:
      - app/(marketing)/layout.tsx
      - app/(marketing)/page.tsx
      - app/(marketing)/pricing/page.tsx
      - app/(marketing)/contact/page.tsx
      - app/(marketing)/signin/page.tsx
      - app/(public)/start/page.tsx
      - app/(onboarding)/layout.tsx
      - app/(onboarding)/bootstrap/page.tsx
      - app/(onboarding)/setup/page.tsx
      - components/marketing/header.tsx
      - components/marketing/mobile-menu-toggle.tsx
      - components/marketing/footer.tsx
    gate: type-check
    estimated_complexity: high

  WS4:
    name: Landing Page Content
    description: Build all 10 marketing sections per COPY-DECK, install accordion, wire CTAs
    executor: frontend-design-pt-2
    executor_type: skill
    depends_on: [WS3]
    outputs:
      - components/ui/accordion.tsx
      - components/marketing/sections/hero.tsx
      - components/marketing/sections/problems.tsx
      - components/marketing/sections/capabilities.tsx
      - components/marketing/sections/how-it-works.tsx
      - components/marketing/sections/social-proof.tsx
      - components/marketing/sections/pricing-teaser.tsx
      - components/marketing/sections/faq.tsx
      - components/marketing/sections/final-cta.tsx
      - components/marketing/timeline-step.tsx
      - app/(marketing)/page.tsx
      - app/layout.tsx
    gate: build
    estimated_complexity: high

  WS5:
    name: UI Consolidation
    description: Install sonner into components/ui/, fix orphaned imports, delete landing-page/ui/, delete app/home
    executor: frontend-design-pt-2
    executor_type: skill
    depends_on: [WS4]
    outputs:
      - components/ui/sonner.tsx
      - app/providers.tsx
      - hooks/ui/index.ts
      - hooks/ui.ts
    gate: build
    estimated_complexity: medium

  WS6:
    name: Quality Validation
    description: Final quality gates — build, type-check, lint, route verification, forbidden imports, brand compliance
    executor: qa-specialist
    executor_type: skill
    depends_on: [WS2, WS4, WS5]
    outputs: []
    gate: build
    estimated_complexity: medium

# Execution Phases (topologically sorted, parallelized where possible)
execution_phases:
  - name: "Phase 1 - Database Foundation"
    parallel: [WS1]
    gates: [schema-validation]

  - name: "Phase 2 - Routes & Auth [ATOMIC]"
    parallel: [WS2, WS3]
    gates: [type-check, build]

  - name: "Phase 3 - Content & Auth Flows"
    parallel: [WS4]
    gates: [type-check, build]

  - name: "Phase 4 - UI Consolidation"
    parallel: [WS5]
    gates: [build, type-check]

  - name: "Phase 5 - Quality Validation"
    parallel: [WS6]
    gates: [build, lint]

# Validation Gates
gates:
  schema-validation:
    command: "npm run db:types && npm run type-check"
    success_criteria: "Exit code 0, database.types.ts includes setup_status"

  type-check:
    command: "npm run type-check"
    success_criteria: "Exit code 0"

  build:
    command: "npm run build"
    success_criteria: "Exit code 0, / route shows as static in build output"

  lint:
    command: "npm run lint"
    success_criteria: "Exit code 0"

# External Dependencies
external_dependencies:
  - prd: PRD-PATCH-START-GATEWAY-v0.1
    service: OnboardingContext
    required_for: "Gateway decision tree specification"
  - prd: ADR-030
    service: AuthContext
    required_for: "Middleware auth mechanism (getClaims pattern)"

# Risks and Mitigations
risks:
  - risk: "Middleware re-enablement locks out users if public paths misconfigured"
    mitigation: "Test ALL routes in manual verification matrix before merge"
  - risk: "Backfill sets setup_status='ready' for casinos needing setup"
    mitigation: "No wizard exists yet — all casinos effectively ready for v0.1"
  - risk: "Providers crash after landing-page/ui deletion"
    mitigation: "Fix ALL imports and verify build BEFORE any deletion"
  - risk: "force-static fails from leaked dynamic imports"
    mitigation: "npm run build will error immediately; easy to fix"

---

# EXEC-SPEC-024: Landing Page Overhaul + Start Gateway v0

> **Validated Execution Specification for PRD-024**
> Reviewed against codebase state at commit 7a01651 on branch `landing-page-gateway`.
> Expert-refined workstreams by: backend-service-builder, frontend-design-pt-2, qa-specialist.

---

## 0. Review Summary — Corrections from Proposed Plan

The proposed plan in PRD-024 Appendix A has **five structural issues** that this EXEC-SPEC corrects:

| # | Issue | Severity | Correction |
|---|-------|----------|------------|
| **C1** | Phase 1A (middleware) and Phase 1B (routes) cannot be separate PRs — middleware redirects to `/signin` which does not exist until Phase 1B lands | **BLOCKER** | Merge into single atomic Phase 2 with WS2+WS3 in parallel |
| **C2** | Phase 0 migration sets `setup_status DEFAULT 'not_started'` but does not backfill existing casinos — all active users would be routed to `/setup` instead of `/pit` | **BLOCKER** | Migration must `UPDATE casino_settings SET setup_status = 'ready'` for all existing rows |
| **C3** | Dashboard pages (`pit/page.tsx`, `compliance/page.tsx`, `protected/page.tsx`) have hardcoded `redirect('/auth/login')` not addressed in any phase | **HIGH** | Added to WS2 scope |
| **C4** | `app/providers.tsx` imports `Toaster` from `@/components/landing-page/ui/sonner` — Phase 4 deletion would break the app | **BLOCKER** | WS5 must install sonner into `components/ui/` and fix imports BEFORE deleting |
| **C5** | `/start` and `/signin` route group placement contradicts between LANDING-IA and PRD Route Map | **MEDIUM** | `/signin` under `(marketing)` for UX; `/start` under `(public)` as redirect-only gateway |

---

## 1. Dependency Graph

```
Phase 1 [WS1] — Database Foundation
    │
    ▼
Phase 2 [WS2 ∥ WS3] — Routes & Auth [ATOMIC]
    │
    ▼
Phase 3 [WS4] — Landing Content
    │
    ▼
Phase 4 [WS5] — UI Consolidation
    │
    ▼
Phase 5 [WS6] — Quality Validation
```

**Parallel execution:** WS2 (backend-service-builder) and WS3 (frontend-design-pt-2) run concurrently in Phase 2.

---

## 2. Workstream Details

### WS1: Database Migration

**Executor:** `backend-service-builder`
**Bounded Context:** CasinoService (Foundational) — owns `casino_settings`
**Dependencies:** None

**Purpose:** Add `setup_status` and `setup_completed_at` to `casino_settings`. Backfill existing rows to `ready` so current users are not broken by the gateway.

**Migration file:** `supabase/migrations/20260201173234_prd024_casino_setup_status.sql`

```sql
-- ============================================================================
-- Migration: PRD-024 — Add setup_status to casino_settings
-- Created: 2026-01-30
-- Reference: PRD-024 (Landing Page Overhaul + Start Gateway v0)
-- Bounded Context: CasinoService (owns casino_settings)
-- ============================================================================

BEGIN;

ALTER TABLE casino_settings
  ADD COLUMN setup_status text NOT NULL DEFAULT 'not_started'
    CONSTRAINT casino_settings_setup_status_check
      CHECK (setup_status IN ('not_started', 'in_progress', 'ready')),
  ADD COLUMN setup_completed_at timestamptz;

-- CRITICAL BACKFILL: Without this, ALL existing users route to /setup
UPDATE casino_settings
  SET setup_status = 'ready',
      setup_completed_at = now()
  WHERE setup_status = 'not_started';

NOTIFY pgrst, 'reload schema';

COMMIT;
```

**Post-migration:** Run `npm run db:types` to regenerate `types/remote/database.types.ts`.

**Patterns:**
- Migration Naming Standard: `YYYYMMDDHHMMSS_descriptive_name.sql` (timestamp > 20260129205310)
- Text + CHECK over Enum per PRD-PATCH recommendation
- Named constraint for debuggability
- BEGIN/COMMIT wrap for atomicity
- NOTIFY pgrst for PostgREST schema cache refresh

**Acceptance Criteria:**
- [ ] Migration applies cleanly on local Supabase
- [ ] `npm run db:types` succeeds
- [ ] `casino_settings` type includes `setup_status: string` and `setup_completed_at: string | null`
- [ ] `npm run type-check` passes
- [ ] Existing rows have `setup_status = 'ready'`
- [ ] CHECK constraint named `casino_settings_setup_status_check`

---

### WS2: Middleware & Auth Updates

**Executor:** `backend-service-builder`
**Bounded Context:** AuthContext
**Dependencies:** None (parallel with WS3, ships atomically)

**Purpose:** Restore middleware, expand public paths, update redirect targets, re-enable layout auth guards, update all hardcoded auth redirects.

**Outputs (9 files):**

| File | Action | Change |
|------|--------|--------|
| `middleware.ts` | CREATE (from .bak) | Restore from `middleware.ts.bak` |
| `lib/supabase/middleware.ts` | MODIFY | Expand public paths array, redirect to `/signin` |
| `app/(dashboard)/layout.tsx` | MODIFY | Uncomment auth guard, redirect to `/signin` |
| `app/(protected)/layout.tsx` | MODIFY | Uncomment auth guard, redirect to `/signin` |
| `components/login-form.tsx` | MODIFY | Line 44: `router.push('/pit')` → `router.push('/start')` |
| `app/(public)/auth/confirm/route.ts` | MODIFY | Line 11: default next `/` → `/start` |
| `app/(dashboard)/pit/page.tsx` | MODIFY | Lines 45, 54: `redirect('/auth/login')` → `redirect('/signin')` |
| `app/(dashboard)/compliance/page.tsx` | MODIFY | Lines 48, 58: `redirect('/auth/login')` → `redirect('/signin')` |
| `app/protected/page.tsx` | MODIFY | Line 11: `redirect('/auth/login')` → `redirect('/signin')` |

**Middleware public paths:**
```typescript
const publicPaths = [
  '/',           // Marketing landing page
  '/signin',     // Sign-in page
  '/start',      // Gateway (redirect-only)
  '/pricing',    // Marketing stub
  '/contact',    // Marketing stub
  '/auth',       // Existing auth flows
  '/review',     // Dev review pages
  '/login',      // Backwards compat
  '/bootstrap',  // Onboarding (internal auth check)
  '/setup',      // Setup wizard (internal auth check)
];
```

**Critical preservations:**
- `getClaims()` on line 48 stays as-is (ADR-030 compliance)
- `hasEnvVars` guard stays as-is
- Cookie handling code stays as-is
- Do NOT change `redirect('/pit')` on compliance line 65 (role-based, not auth)

**Acceptance Criteria:**
- [ ] `middleware.ts` exists (not `.bak`)
- [ ] Public paths include all 10 paths listed above
- [ ] Middleware redirects to `/signin` (not `/auth/login`)
- [ ] `getClaims()` preserved (not replaced with `getUser()`)
- [ ] Dashboard layout auth guard uncommented and active
- [ ] Protected layout auth guard uncommented and active
- [ ] LoginForm redirects to `/start`
- [ ] Auth confirm defaults next to `/start`
- [ ] Zero `redirect('/auth/login')` calls remain (grep verification)
- [ ] `npm run type-check` passes

---

### WS3: Route Structure & Gateway

**Executor:** `frontend-design-pt-2`
**Bounded Context:** MarketingContext + OnboardingContext
**Dependencies:** [WS1] (gateway reads `setup_status`)

**Purpose:** Create all new route groups, pages, marketing header/footer stubs, and the /start gateway decision tree.

**Outputs (13 files):**

| File | Type | Description |
|------|------|-------------|
| `app/(marketing)/layout.tsx` | Server Component | Marketing layout with header + children + footer |
| `app/(marketing)/page.tsx` | Server Component | Stub landing page (`force-static`, no auth) |
| `app/(marketing)/pricing/page.tsx` | Server Component | Pricing stub (`force-static`) |
| `app/(marketing)/contact/page.tsx` | Server Component | Contact stub (`force-static`) |
| `app/(marketing)/signin/page.tsx` | Server Component | Wraps LoginForm in marketing layout |
| `app/(public)/start/page.tsx` | Server Component | Gateway decision tree (`force-dynamic`) |
| `app/(onboarding)/layout.tsx` | Server Component | Minimal layout |
| `app/(onboarding)/bootstrap/page.tsx` | Server Component | Placeholder "Coming soon" |
| `app/(onboarding)/setup/page.tsx` | Server Component | Placeholder "Coming soon" |
| `components/marketing/header.tsx` | Server + Client island | Stub header with logo, nav, CTAs |
| `components/marketing/mobile-menu-toggle.tsx` | Client (`'use client'`) | Hamburger menu state for mobile |
| `components/marketing/footer.tsx` | Server Component | Stub footer with nav + copyright |
| `app/(public)/page.tsx` | DELETE | Remove old landing page with auth call |

**Gateway decision tree** (`app/(public)/start/page.tsx`):
1. Not authenticated → `redirect('/signin')`
2. Authenticated + no active staff row → `redirect('/bootstrap')`
3. Authenticated + staff active + `setup_status` != `'ready'` → `redirect('/setup')`
4. Authenticated + staff active + `setup_status` = `'ready'` → `redirect('/pit')`
5. Staff exists but inactive → `redirect('/signin')` with error param
6. No casino_settings row → `redirect('/setup')` (defensive)

**Patterns:**
- Next.js Route Groups: `(marketing)`, `(public)`, `(onboarding)` share URL namespace
- Server Component default — only mobile-menu-toggle uses `'use client'`
- `force-static` on marketing pages, `force-dynamic` on gateway
- Client island pattern: header is Server Component, mobile toggle is separate Client file
- Supabase server client for gateway queries (no SET LOCAL)

**Acceptance Criteria:**
- [ ] All 12 route/component files created
- [ ] `app/(public)/page.tsx` deleted (old landing page)
- [ ] `/` unauthenticated shows stub landing page
- [ ] `/start` unauthenticated redirects to `/signin`
- [ ] `/start` authenticated (setup=ready) redirects to `/pit`
- [ ] `/signin` shows LoginForm with marketing layout
- [ ] `/pricing`, `/contact` show stub content
- [ ] `/bootstrap`, `/setup` show placeholder content
- [ ] Zero HeroUI imports in any new file
- [ ] Zero motion imports in any new file
- [ ] `npm run build` succeeds with `/` as static

---

### WS4: Landing Page Content

**Executor:** `frontend-design-pt-2`
**Bounded Context:** MarketingContext
**Dependencies:** [WS3] (marketing route group must exist)

**Pre-requisite:** `npx shadcn@latest add accordion` → creates `components/ui/accordion.tsx`

**Purpose:** Build all 10 marketing sections per COPY-DECK-v0.1.md and LANDING-IA-v0.1.md.

**Section components (8 new files + 1 utility):**

| File | Type | Anchor | shadcn Components |
|------|------|--------|-------------------|
| `components/marketing/sections/hero.tsx` | Server | `#hero` | Button, Badge |
| `components/marketing/sections/problems.tsx` | Server | `#problems` | — |
| `components/marketing/sections/capabilities.tsx` | Server | `#capabilities` | Card, CardHeader, CardTitle, CardContent |
| `components/marketing/sections/how-it-works.tsx` | Server | `#how-it-works` | — (uses TimelineStep) |
| `components/marketing/sections/social-proof.tsx` | Server | `#principles` | — |
| `components/marketing/sections/pricing-teaser.tsx` | Server | `#pricing` | Card, Badge, Button |
| `components/marketing/sections/faq.tsx` | Client (`'use client'`) | `#faq` | Accordion, AccordionItem, AccordionTrigger, AccordionContent |
| `components/marketing/sections/final-cta.tsx` | Server | `#start` | Button |
| `components/marketing/timeline-step.tsx` | Server | — | — |

**Also updates:**
- `app/(marketing)/page.tsx` — full 10-section composition with `force-static`
- `components/marketing/header.tsx` — full nav with anchor links, sticky positioning
- `components/marketing/footer.tsx` — full footer per copy deck
- `app/layout.tsx` — metadata title → "Player Tracker"

**Design system (from LANDING-IA):**
- Container: `max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8`
- Section padding: `py-16 md:py-20 lg:py-24`
- Hero headline: `text-4xl md:text-5xl lg:text-6xl font-bold`
- Section headlines: `text-3xl md:text-4xl font-semibold`
- Body copy: `text-base md:text-lg`
- Colors: existing PT-2 Industrial theme from `globals.css`

**Constraints (PRD FR-8 through FR-11):**
- NO HeroUI imports
- NO motion/framer-motion imports
- NO gradient text or gradient backgrounds
- CSS transitions only
- Hero visual: static product mock placeholder
- All copy verbatim from COPY-DECK-v0.1.md

**Copy deck source:** `docs/00-vision/landing-page/COPY-DECK-v0.1.md`

**Acceptance Criteria:**
- [ ] shadcn Accordion installed at `components/ui/accordion.tsx`
- [ ] All 8 section components + timeline-step created
- [ ] Landing page composes all sections with `force-static`
- [ ] All copy verbatim from COPY-DECK-v0.1.md
- [ ] All "Get started" CTAs → `/start` (>= 3 locations)
- [ ] All "Sign in" CTAs → `/signin` (>= 2 locations)
- [ ] FAQ accordion expands/collapses (7 items)
- [ ] Mobile responsive (header toggle, sections stack)
- [ ] Brand name "Player Tracker" throughout
- [ ] `npm run build` succeeds with `/` as static
- [ ] Zero HeroUI/motion/gradient imports

---

### WS5: UI Consolidation

**Executor:** `frontend-design-pt-2`
**Bounded Context:** Cross-cutting
**Dependencies:** [WS4] (new components must replace old)

**Execution order (sequential dependency within workstream):**
1. Install sonner: `npx shadcn@latest add sonner` → `components/ui/sonner.tsx`
2. Fix orphaned imports:
   - `app/providers.tsx`: `@/components/landing-page/ui/sonner` → `@/components/ui/sonner`
   - `hooks/ui/index.ts`: `@/components/landing-page/ui/sonner` → `sonner`
   - `hooks/ui.ts`: `@/components/landing-page/ui/sonner` → `sonner`
3. Verify zero external references: `grep -r "landing-page/ui/" --include='*.ts' --include='*.tsx'`
4. Delete `components/landing-page/ui/` (46 files)
5. Delete `app/home/page.tsx` (old HeroUI landing at `/home`)
6. Deprecate `components/landing-page/` (add `DEPRECATED.md` or delete if zero external refs)
7. Run gates: `npm run type-check && npm run build`

**Acceptance Criteria:**
- [ ] `components/ui/sonner.tsx` exists (shadcn CLI install)
- [ ] `app/providers.tsx` imports Toaster from `@/components/ui/sonner`
- [ ] `hooks/ui/index.ts` exports toast from `sonner` (not landing-page path)
- [ ] `hooks/ui.ts` exports toast from `sonner` (not landing-page path)
- [ ] `components/landing-page/ui/` deleted
- [ ] `app/home/page.tsx` deleted
- [ ] Zero external imports referencing `@/components/landing-page/ui/`
- [ ] Toast notifications still work in existing app features
- [ ] `npm run build` passes
- [ ] `npm run type-check` passes

---

### WS6: Quality Validation

**Executor:** `qa-specialist`
**Dependencies:** [WS2, WS4, WS5] (all code must exist)

**Automated checks (15 steps):**

| ID | Check | Command | Pass Criteria |
|----|-------|---------|---------------|
| S1 | Build | `npm run build` | Exit 0, `/` route static (○) |
| S2 | Type check | `npm run type-check` | Exit 0 |
| S3 | Lint | `npm run lint` | Exit 0 |
| S4 | Route files exist | `test -f` for all 6 marketing routes | All exist |
| S5 | Static generation | grep for auth calls in landing page | Zero matches |
| S6 | No HeroUI in marketing | `grep -rn '@heroui' components/marketing/` | Zero matches |
| S6b | No motion in marketing | `grep -rn 'motion\|framer-motion' components/marketing/` | Zero matches |
| S7 | No broken imports | `grep -rn 'landing-page/ui/' app/ hooks/` | Zero matches |
| S8 | Brand: no "CasinoTrack Pro" | `grep -rn 'CasinoTrack Pro' components/marketing/` | Zero matches |
| S8b | Brand: no "PT-2 Pit Station" | `grep -rn 'PT-2 Pit Station' components/marketing/` | Zero matches |
| S9 | No console.* in marketing | `grep -rn 'console\.' components/marketing/` | Zero matches |
| S9b | No `as any` in marketing | `grep -rn 'as any' components/marketing/` | Zero matches |
| S10 | Middleware active | `test -f middleware.ts` | File exists |
| S11 | LoginForm → /start | `grep 'router.push' components/login-form.tsx` | Contains `/start` |
| S12 | DB types include setup_status | `grep 'setup_status' types/remote/database.types.ts` | Found |
| S13 | CTA count | `grep -rn '/start' components/marketing/` | >= 3 matches |
| S14 | Gateway redirects | `grep -c 'redirect' app/(public)/start/page.tsx` | >= 4 |

**Manual verification (P0 blockers):**
- MV-1: Visual section completeness (all 10 sections render)
- MV-7: Sign-in flow (Sign in → /signin → login → /start → /pit)
- MV-8: Gateway 4-state redirect (unauthed, no staff, incomplete, ready)
- MV-9: Protected route enforcement (all dashboard routes redirect when unauthed)
- MV-10: Public route accessibility (/, /pricing, /contact, /signin, /start accessible)

**Advisory checks:**
- MV-2: Copy deck alignment (verbatim check)
- MV-3: Mobile responsive layout (375px, 768px, 1024px, 1440px)
- MV-4: FAQ accordion interactivity
- MV-5: Mobile nav toggle
- MV-6: Hero static product mock (not stock photo)

---

## 3. Bounded Context Ownership

| Phase | Primary Context | Tables Touched | Expert |
|-------|----------------|----------------|--------|
| Phase 1 | CasinoService | `casino_settings` (ALTER + UPDATE) | backend-service-builder |
| Phase 2 | AuthContext + MarketingContext + OnboardingContext | None (reads only) | backend-service-builder ∥ frontend-design-pt-2 |
| Phase 3 | MarketingContext | None | frontend-design-pt-2 |
| Phase 4 | Cross-cutting | None | frontend-design-pt-2 |
| Phase 5 | Cross-cutting | None | qa-specialist |

**SRM Impact:** No SRM update needed for v0.1. MarketingContext and OnboardingContext own no tables.

---

## 4. Security Review

### ADR-030 Compatibility

| ADR-030 Decision | Impact | Status |
|-----------------|--------|--------|
| D1: Context RPC as single source of truth | /start gateway uses standard Supabase client, no `SET LOCAL` | **COMPATIBLE** |
| D2: JWT claims lifecycle | No changes to claims sync/clear | **NO IMPACT** |
| D3: Bypass knob lockdown | Dev bypass mechanism unchanged | **COMPATIBLE** |
| D4: Write-path RLS requires session vars | /start gateway is read-only | **NO IMPACT** |

### Start Gateway Security

| Requirement | Status |
|-------------|--------|
| FR-16: No tenant data on /start page | Redirect-only, no rendered content |
| FR-13: Server-side DB queries only | Uses `createClient()` server-side |
| FR-14: Staff binding user_id + active | Query includes both conditions |
| PRD-PATCH §6: No SET LOCAL | Standard Supabase client |

---

## 5. Risk Register

| ID | Phase | Risk | P | I | Mitigation |
|----|-------|------|---|---|------------|
| R1 | 1 | Backfill sets setup_status='ready' for incomplete casinos | Low | Low | No wizard exists yet |
| R2 | 2 | Middleware locks out users (misconfigured public paths) | Med | **HIGH** | Manual route test matrix |
| R3 | 2 | Redirect loop (/start → /signin → /start) | Low | Med | Gateway redirects to /signin with query param for inactive staff |
| R4 | 3 | 10-section content scope creep | Med | Med | Use COPY-DECK verbatim |
| R5 | 3 | force-static fails from leaked dynamic imports | Low | Low | Build errors immediately |
| R6 | 4 | Providers crash after landing-page/ui deletion | Med | **HIGH** | Fix ALL imports before ANY deletion |
| R7 | 4 | HeroUI removal breaks dashboard | Med | Med | Audit first, defer removal |

---

## 6. Blocking Issues

| ID | Description | Must Resolve Before |
|----|-------------|---------------------|
| **B1** | Migration MUST backfill existing rows to `setup_status = 'ready'` | Phase 1 gate |
| **B2** | WS2 + WS3 MUST ship atomically (middleware + routes co-dependent) | Phase 2 gate |
| **B3** | sonner must be installed + imports fixed BEFORE `landing-page/ui/` deletion | Phase 4 gate |

---

## 7. Open Questions

| # | Question | Default |
|---|----------|---------|
| 1 | `/bootstrap` and `/setup` middleware-public or protected? | Public (internal auth check) |
| 2 | `app/home/page.tsx` redirect to `/` or delete? | Delete |
| 3 | Remove HeroUIProvider from Providers in Phase 4? | Defer (audit first) |
| 4 | Hero visual: placeholder SVG or skip? | Placeholder div |

---

## 8. Definition of Done

- [ ] All 6 workstream outputs created
- [ ] All gates pass (schema-validation, type-check, build, lint)
- [ ] No regressions in existing tests
- [ ] Security: middleware active, layout guards active, gateway redirect-only
- [ ] No `as any`, no `console.*` in marketing components
- [ ] No `@heroui`, no `motion` in marketing surface
- [ ] All copy matches COPY-DECK-v0.1.md
- [ ] Brand name "Player Tracker" throughout
- [ ] Static generation confirmed for `/`

---

## References

| Document | Path |
|----------|------|
| PRD-024 | `docs/10-prd/PRD-024-landing-page-start-gateway-v0.md` |
| Copy Deck v0.1 | `docs/00-vision/landing-page/COPY-DECK-v0.1.md` |
| Landing IA v0.1 | `docs/00-vision/landing-page/LANDING-IA-v0.1.md` |
| Start Gateway PRD-PATCH | `docs/00-vision/company-onboarding/PRD-PATCH-START-GATEWAY-v0.1.md` |
| ADR-030 Auth Hardening | `docs/80-adrs/ADR-030-auth-system-hardening.md` |
| SRM v4.11.0 | `docs/20-architecture/SERVICE_RESPONSIBILITY_MATRIX.md` |

---

*Validated by lead-architect. Expert-refined by backend-service-builder, frontend-design-pt-2, qa-specialist. 2026-01-30.*
