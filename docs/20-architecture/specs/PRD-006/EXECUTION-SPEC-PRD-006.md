---
# EXECUTION-SPEC Frontmatter
# Generated by prd-pipeline skill

prd: PRD-006
prd_title: "Pit Dashboard UI (GATE-2 Completion)"
service: Dashboard
mvp_phase: 2  # Session Management + UI

# Workstream Definitions
workstreams:
  WS1:
    name: TableLayoutTerminal Enhancement
    description: Add dashboard props to existing component (tableId, gameType, tableStatus, activeSlipsCount, variant, isSelected, onTableAction)
    agent: pt2-frontend-implementer
    depends_on: []
    outputs:
      - components/table/table-layout-terminal.tsx
    gate: type-check
    estimated_complexity: low

  WS3:
    name: Dashboard Data Layer
    description: React Query hooks for dashboard tables, slips, and stats
    agent: pt2-service-implementer
    depends_on: []
    outputs:
      - hooks/dashboard/index.ts
      - hooks/dashboard/use-dashboard-tables.ts
      - hooks/dashboard/use-dashboard-slips.ts
      - hooks/dashboard/use-dashboard-stats.ts
    gate: type-check
    estimated_complexity: medium

  WS2:
    name: Dashboard Page & Layout
    description: Main dashboard page with stats bar, table grid, and expanded view
    agent: pt2-frontend-implementer
    depends_on: [WS1]
    outputs:
      - app/dashboard/page.tsx
      - app/dashboard/layout.tsx
      - components/dashboard/stats-bar.tsx
      - components/dashboard/table-grid.tsx
    gate: type-check
    estimated_complexity: medium

  WS4:
    name: Slip Management UI
    description: Active slips panel, new slip modal, slip lifecycle actions
    agent: pt2-frontend-implementer
    depends_on: [WS2, WS3]
    outputs:
      - components/dashboard/active-slips-panel.tsx
      - components/dashboard/new-slip-modal.tsx
      - components/dashboard/seat-context-menu.tsx
    gate: type-check
    estimated_complexity: medium

  WS5:
    name: Real-time Updates (P1)
    description: Supabase realtime subscriptions for tables and slips
    agent: pt2-service-implementer
    depends_on: [WS3]
    outputs:
      - hooks/dashboard/use-dashboard-realtime.ts
    gate: type-check
    estimated_complexity: medium

  WS6:
    name: Testing & Validation
    description: Unit tests for hooks, integration tests for slip actions, E2E test
    agent: backend-architect
    depends_on: [WS1, WS2, WS3, WS4]
    outputs:
      - hooks/dashboard/*.test.ts
      - __tests__/dashboard/dashboard.integration.test.ts
    gate: test-pass
    estimated_complexity: medium

# Execution Phases (topologically sorted, parallelized where possible)
execution_phases:
  - name: Phase 1 - Foundation
    description: Component enhancement + data layer (no dependencies)
    parallel: [WS1, WS3]
    gates: [type-check]

  - name: Phase 2 - Dashboard Page
    description: Main page layout (depends on WS1)
    parallel: [WS2]
    gates: [type-check]

  - name: Phase 3 - Integration
    description: Slip UI + realtime (depends on WS2, WS3)
    parallel: [WS4, WS5]
    gates: [type-check]

  - name: Phase 4 - Validation
    description: Testing and quality gates
    parallel: [WS6]
    gates: [test-pass, build]

# Validation Gates
gates:
  type-check:
    command: npm run type-check
    success_criteria: "Exit code 0, no TypeScript errors"

  lint:
    command: npm run lint
    success_criteria: "Exit code 0, no errors (warnings OK)"

  test-pass:
    command: npm test -- --testPathPattern=dashboard
    success_criteria: "All dashboard tests pass"

  build:
    command: npm run build
    success_criteria: "Build succeeds, p95 LCP ready for measurement"

# Dependencies on other PRDs/Services
external_dependencies:
  - prd: PRD-000
    service: CasinoService
    required_for: "Gaming day context, casino settings"
  - prd: PRD-HZ-001
    service: TableContextService
    required_for: "Table state machine, seat occupancy"
  - prd: PRD-003
    service: RatingSlipService
    required_for: "Slip lifecycle (start/pause/resume/close)"
  - prd: PRD-003
    service: PlayerService
    required_for: "Player search for new slip creation"
  - prd: PRD-003
    service: VisitService
    required_for: "Check-in/check-out context"

# Risks and Mitigations
risks:
  - risk: "TableLayoutTerminal modifications may break existing usage"
    mitigation: "All new props are optional with sensible defaults"
  - risk: "Real-time complexity may delay GATE-2"
    mitigation: "WS5 is P1 scope; P0 uses polling/manual refresh"
  - risk: "Large table counts (>20) may affect performance"
    mitigation: "Virtualize grid if needed; test with 50 tables"

# Open Questions (from PRD)
open_questions:
  - question: "Show closed/inactive tables or filter them?"
    recommendation: "Show all, dim inactive/closed"
  - question: "How to handle multiple slips per seat?"
    recommendation: "Show most recent only; list all in detail view"
  - question: "Include gaming day context in stats bar?"
    recommendation: "Yes, show current gaming day from CasinoService"

---

# EXECUTION-SPEC: PRD-006 - Pit Dashboard UI

## Overview

The Pit Dashboard is the primary operational interface for pit bosses to manage gaming tables, active rating slips, and player sessions in real-time. This completes GATE-2 (Session Management + UI) and unblocks Phase 3 (Rewards & Compliance).

## Scope

**In Scope (P0 - GATE-2)**:
- Stats bar: Active tables, open slips, checked-in players
- Table grid with status indicators and thumbnails
- Expanded TableLayoutTerminal for selected table
- Active slips panel with pause/resume/close actions
- New slip creation modal

**In Scope (P1)**:
- Supabase realtime subscriptions for auto-updates
- Table quick actions (open/close)
- Compact table thumbnails

**Out of Scope**:
- Floor layout design/editing
- Dealer rotation management
- Historical reporting dashboards
- Mobile-optimized view
- Multi-pit support

## Architecture Context

- **TableLayoutTerminal**: Existing component at `components/table/table-layout-terminal.tsx` - needs 7 new props
- **Services**: All backend services complete (CasinoService, TableContextService, RatingSlipService, PlayerService, VisitService)
- **State Management**: React Query for server state, component state for UI interactions
- **RLS**: Dashboard respects casino-scoped RLS - users only see their casino's tables

## Workstream Details

### WS1: TableLayoutTerminal Enhancement

**Purpose**: Add dashboard-specific props to enable grid view and selection.

**Deliverables**:
1. Add `tableId` prop for display label (T1, T2, etc.)
2. Add `gameType` prop for game badge (blackjack, poker, etc.)
3. Add `tableStatus` prop for status indicator (active/inactive/closed)
4. Add `activeSlipsCount` prop for slip count badge
5. Add `variant` prop for size ('full' | 'compact')
6. Add `isSelected` prop for selection highlight
7. Add `onTableAction` callback for quick actions

**Acceptance Criteria**:
- [ ] All new props are optional with sensible defaults
- [ ] Compact variant renders at ~100x80px
- [ ] Full variant unchanged from current behavior
- [ ] Type-check passes

### WS3: Dashboard Data Layer

**Purpose**: Create React Query hooks for dashboard data fetching.

**Deliverables**:
1. `use-dashboard-tables.ts` - Fetch all tables for casino with seat occupancy
2. `use-dashboard-slips.ts` - Fetch active slips for selected table
3. `use-dashboard-stats.ts` - Aggregate stats (active tables, open slips, players)
4. Key factories in `hooks/dashboard/keys.ts`

**Acceptance Criteria**:
- [ ] Hooks use existing service methods (TableContextService, RatingSlipService)
- [ ] Query composition follows PT-2 patterns
- [ ] Error handling with proper fallbacks
- [ ] Type-check passes

### WS2: Dashboard Page & Layout

**Purpose**: Create the main dashboard page with layout components.

**Deliverables**:
1. `app/dashboard/page.tsx` - Main page with data fetching
2. `app/dashboard/layout.tsx` - Dashboard shell/nav
3. `components/dashboard/stats-bar.tsx` - Top stats display
4. `components/dashboard/table-grid.tsx` - Grid of table thumbnails

**Acceptance Criteria**:
- [ ] Page renders at `/dashboard`
- [ ] Stats bar shows 3 metrics (active tables, open slips, checked-in players)
- [ ] Clicking table thumbnail sets selected table state
- [ ] Selected table shows expanded TableLayoutTerminal
- [ ] Type-check passes

### WS4: Slip Management UI

**Purpose**: Build UI for managing rating slips from the dashboard.

**Deliverables**:
1. `active-slips-panel.tsx` - List of active slips with actions
2. `new-slip-modal.tsx` - Modal for creating new slip
3. `seat-context-menu.tsx` - Right-click/tap menu on seat

**Acceptance Criteria**:
- [ ] Slip actions call RatingSlipService lifecycle methods
- [ ] New slip modal has player search integration
- [ ] Optimistic updates via React Query mutations
- [ ] Type-check passes

### WS5: Real-time Updates (P1)

**Purpose**: Enable automatic dashboard updates via Supabase realtime.

**Deliverables**:
1. `use-dashboard-realtime.ts` - Subscribe to table/slip changes
2. React Query cache invalidation on realtime events

**Acceptance Criteria**:
- [ ] Subscribes to `gaming_table` changes
- [ ] Subscribes to `rating_slip` changes
- [ ] Invalidates relevant queries on change
- [ ] Graceful degradation if realtime unavailable

### WS6: Testing & Validation

**Purpose**: Ensure dashboard functionality through automated tests.

**Deliverables**:
1. Unit tests for dashboard hooks
2. Integration tests for slip lifecycle actions
3. E2E test: View tables → Select → Start slip → Pause → Close

**Acceptance Criteria**:
- [ ] Hook tests cover query composition
- [ ] Integration tests verify slip state transitions
- [ ] E2E test passes in CI
- [ ] Build succeeds

## Definition of Done

- [ ] Dashboard loads at `/dashboard` within 2.5s LCP target
- [ ] All 6 workstreams complete
- [ ] All gates pass (type-check, lint, test-pass, build)
- [ ] MVP-ROADMAP.md updated with GATE-2 completion
- [ ] PRD-006 status changed to "Complete"
