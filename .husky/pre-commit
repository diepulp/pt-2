# Run service layer anti-pattern checks first
.husky/pre-commit-service-check.sh

# Schema verification for database-related changes
if git diff --cached --name-only | grep -qE "(migrations|types/database\.types\.ts|services/.*/(crud|queries|business)\.ts)"; then
  echo "üîç Schema-related changes detected - running verification..."
  npm test schema-verification --silent || {
    echo ""
    echo "‚ùå Schema verification failed!"
    echo ""
    echo "This usually means:"
    echo "  1. Database types are out of sync with schema"
    echo "  2. Service DTOs reference non-existent fields"
    echo ""
    echo "To fix:"
    echo "  npm run db:types"
    echo "  npm test schema-verification"
    echo ""
    exit 1
  }
  echo "‚úÖ Schema verification passed"
fi

# Run standard lint-staged
npm run lint-staged
