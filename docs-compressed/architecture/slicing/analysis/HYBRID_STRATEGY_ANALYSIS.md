PT-2 Hybrid 2025-10-09 Recommended hybrid model 7/8 services (87.5%) 98 tests Phase 2

technical vertical feature delivery vertical layering PT-2 needs technical separation feature user value Management Visit Tracking Horizontal service layer 7 services 98 tests >80% coverage Explicit interfaces typed dependencies bounded contexts Zero PRD violations 4x template velocity Action UI Layer Real-time integration 8 weeks production-ready MVP LOW zero rework HIGHEST 12 weeks vertical 10 weeks horizontal

Hybrid Model Definition Complementary Dimensions DIMENSION Layers UI LAYER React Components Hooks UI State Real-time Sync Server Actions ACTION LAYER Actions Orchestration Cache Authorization Service Factories SERVICE LAYER Queries Transforms Validation Supabase Client DATA LAYER PostgreSQL RLS Policies Triggers Real-time Separation concerns boundaries testability technical responsibility top-down Action Service Data DIMENSION Delivery Player Management User-FacData Layer player table RLS policies Service Layer.create Action Hook useCreatePlayer UI Layer PlayerForm PlayerList PlayerCard Visit Tracking User Data Layer visit table session lifecycle Service Layer.startVisit Action useStartVisit UI Layer VisitForm VisitList VisitTimeline User value demo progress MVP prioritization domain/feature Visit RatingSlip 2 weeks 1.2 Integration Model hybrid model code Service logic Server orchestration React hooks UI components feature Player.create useCreatePlayer PlayerForm Visit Database.startVisit useStartVisit VisitForm Horizontal Technical organization Vertical Feature delivery user value complementary dimensions

Core Domain Boundary Analysis Core Infrastructure Shared infrastructure domains `services/shared/helpers/shared export executeOperation<T Promise Used ALL services Visit RatingSlip Casino MTL TableContext error handling request tracking telemetry Result/shared/types.ts export ServiceResult<T data error success status timestamp requestId Used ALL service methods Standardized response format layers Client/supabase export createBrowserClient createServerClient Used ALL actions real-time hooks Authenticated client instances cookie managementexport Database Generated Supabase schema Used services actions hooks Single source safety Owner Architecture team Change approval Requires cross-domain impact analysis Semantic versioning 2.2 Domain Features Domain-specific business logic reusable across domains/actions services index interface crud operations business workflows queries Search filters transforms DTO mapping validation Player-specific Zod schemas create update delete-list-form-card **Visit (Session Lifecycle services business lifecycle logic validation Visit-specific rules start end cancel **RatingSlip (Performance Tracking services business Points calculation logic validationRating slip constraints create calculate-points Change approval-specific review Changes affect domains Boundary Decision Criteria

Infrastructure 100% domains without modification YES Core NO Domain-specific<domain Feature encode business rules context YES NO Evaluate core extraction Wait 3 identical implementations before abstracting core Premature abstraction maintenance debt Code Decision Rationale wrapper services Player email validation-specific business rule ServiceResult type Standard contract layers Visit lifecycle transitions client factory Required RatingSlip points calculation algorithm

Sequencing Strategy Approach Bottom-Up Foundation Vertical Feature Delivery Data layer schema before services layer Higher layers depend layers vertical slices deliver features addition validated rolled Phased Timeline (8 Weeks MVP 1: Service Layer 1 Data Layer (7 domain tables RLS policies Service Layer modules (7/8 services 98 tests Service Layer enhancement Week MTL Service queries Add business queries modules transforms validation 5 Integration testing Phase 2 audit 7 services services explicit interfaces methods return Test coverage >80% Zero PRD violations 2: Vertical Slice Player 2-3 Action Layer Hooks Server actions update deleteDay 2: React Query hooks Day 3: React Query hooks-player Day 4-5 Testing validation Week 3: UI Layer Day 1-2 Core components-form-list Day 3: Detail components-card Day 4: Real-time integration-players-realtime Multi-tab sync testing Day 5 E2E tests demo-management

Player Management create update delete Real-time synchronization UI forms lists details E2E tests 3: Second Vertical Slice Visit (Weeks 4-5 4: Action Layer Hooks 1-2 Server actions Day Query hooks Day 4-5 Testing validation Week 5 UI Layer 1-2 Core components-form Detail components Real-time integration Day 5 E2E tests demo Visit Tracking start end cancel visits Real session status updates Visit history timelines 4: Third Vertical Slice Rating Slip (Week 6) 6 Full Vertical Slice Day Server actions/calculate-points Day React Query hooksDay 3-4 UI components-form-calculator Day 5 E2E tests demo Rating Slip Creation points calculation visit sessions Performance metrics tracking 5 Real-Time 7 Core wrapper-channel Batch invalidation scheduler 3-4 Domain real-time hooks 5 Memory leak testing multi-tab validation Real-Time UI Synchronization domains updates Batch invalidation subscription lifecycle management Memory leak prevention 6 Production 8)

Week 8 Integration Performance 1-2 Cross-domain workflows Visit RatingSlip MTL Player Casino Bundle optimization Code splitting Dynamic imports heavy components Lighthouse gates LCP â‰¤2.5s TBT Initial JS 5 Deployment automation Migration pipeline Type regeneration validation Production-Ready MVP user flows tested Performance budgets RLS policies audited Deployment pipeline automated Data layer schema Service Action contracts UI APIs Delivery value 2 weeks Demo-able progress domain Increasing complexity Real-time enhancement Rollback points Service layer additions UI

Architectural Integration Patterns 4.1 Shared Kernel Infrastructure infrastructure domains/shared/helpers services/shared/operation-wrapper async function executeOperation requestId await operation error null success true status 200 timestamp new requestId handleServiceError Used all domains DEPENDS cross-domain impact analysis 4.2 Published Language Contracts interfaces layers Service interfaces DTO definitions services/player/indexexport interface PlayerService operations create Promise<ServiceResult getById update delete activate deactivate Query operations searchPlayers getPlayerStats export function createPlayerService Implementation composes modules export PlayerServiceType Layer N+1 depends Layer N interface changes require migration plan Customer-Supplier (Action Service Action "customer service layer/actions-player-action export async function createPlayerAction PlayerCreateDTO Promise<ServiceResult<PlayerDTO>> supabase createServerClient Dependency injection playerService result playerService.create Customer uses supplierrevalidatePath/players Cache invalidation return result Pass ServiceResult One-way dependency call services Services unaware actions 4.4 Conformist Action UI conforms action contracts/actions hooks-create-player import/react-query createPlayerAction/actions export useCreatePlayer queryClient

useMutation createPlayerAction Conform action signature.success queryClient.invalidateQueries.success created 'Failed create player components/player-form.tsx export function PlayerForm( mutate useCreatePlayer resolver(playerCreateSchema PlayerCreateDTO mutate Conform hook interface.handleSubmit UI no negotiation power follows action API Actions UI consumption Anti-Corruption Layer Database domain database schema changes//transforms.ts services/player/transforms.ts import Database.types PlayerRow Database Domain DTO database export PlayerDTO PlayerCreateDTO PlayerUpdateDTO Partial<PlayerCreateDTO Anti-corruption Map database representation domain model export toPlayerDTO id row emailfirstName.firstName Database Domain lastName export toPlayerViewModel id fullName.firstName.lastName emailDisplay.toLowerCase Service layer translates database domain model Database changes break service contracts absorbs

Cross-Layer Communication Patterns 5.1 Data Layer Service Layer Supabase client.types Transform module isolates domain schema services/player export createPlayerCrudService dependency injection<ServiceResult executeOperation await supabase Map database errors domain errors.code_EMAIL player email exists return toPlayerDTO Anti-corruption layer 5.2 Service Layer Action Layer Service interface contract No business logic actions-action async createPlayerAction<ServiceResult supabase await createServerClient playerService createPlayerService Delegation service business logic result await playerService.createrevalidatePath(/players Cache management return result Pass ServiceResult 5.3 Action Layer UI Layer Server action contract React Query manages async-create-player import useMutation useQueryClient createPlayerAction export useCreatePlayer( queryClient return useMutation createPlayerAction queryClient.invalidateQueries created'Failed create player 5.4 Cross-Domain Communication orchestration Action Layer Service-to-Service Direct services/player/business createCasinoService from casinoService createCasinoService.getById Action Layer/actions/player/assign-player-to-action export async function assignPlayerToCasinoAction playerId casinoId createServerClient Orchestrate multiple services action layer casinoServicecasinoService

.success data null error_FOUND success false Validation orchestration logic Services isolated action coordinates Action cross-domain orchestration Services isolated testable reusable

Vertical Horizontal Decision Matrix error logging services Shared infrastructure universal benefit Player CRUD UI User-facing feature Optimizing Supabase client pooling Technical foundation domains Visit check-in flow Domain-specific workflow Zod validation framework Pattern Rating Slip form Feature delivery Migrating new auth system System-wide change layers player search functionality Feature extension single domain Decision Rules HORIZONTAL Addition infrastructure cross-cutting system evolution infrastructure VERTICAL Delivery user-facing functionality Domain-specific business logic MVP prioritization Risk mitigation 1 domain VERTICAL domains HORIZONTAL user-facing technical HORIZONTAL

7. Folder

pt-2/ supabase migrations HORIZONTAL Schema evolution 001_create_player.sql 002_create_visit.sql 003_ratingslip.sql types database.types.ts Single source truth helpers Shared utilities service-result database-helpers domains Domain DTOs player-dto.ts-create-dto-update-dto visit-create-dto services shared Core infrastructure operation-wrapper executeOperation() types ServiceResult utils generateRequestId() player Player domain index.ts PlayerService interface factory crud.ts module business.ts workflows queries Complex queries transforms DTO mapping validation.ts Zod schemas visit Visit domain index.ts crud business.ts Session lifecycle queries transforms validation lib Shared utilities supabase client.ts Browser client factory server.Server client factory query-client.ts React Query config invalidation-scheduler.ts Real-time batching app actions Server actions by domain player create-player-action update-player-action delete-player-action visit start-visit-action end-visit cancel-visit-action players UI routes by feature page.tsx Player list page Player detail page hooks React Query hooks by domain player use-players.ts List query-player Single query-create-player.ts-update-player.ts use-players-realtime.ts Real-time sync visit use-visits-visit components ui Shared UI primitives button.tsx form dialog.tsx player Player domain components player-list.tsx-form player-card.tsx player-detail.tsx visit Visit domain components visit-list.tsx visit-form.tsx-timeline.tsx **tests** VERTICAL by domain services player player-service.test.ts crud.test.ts player.integration.test.ts visit-service.test.integration.test actions player create-player-action.test.ts visit start-visit-action.test.ts components player player-form.test.tsx visit-form.test.tsx

7.1 Navigation Guide Developers player creation/player/crud.ts method/actions/player/create-player-action.ts/player/use-create-player.ts `components/player/player-form.tsx shared `types/helpers/ `services/shared/ **Supabase `lib/supabase/ `components/ui/ add new `supabase/migrations/xxx*create*<domain>.sql/domains/<domain>//<domain>/ `SERVICE_TEMPLATE.md/actions/<domain>//<domain>//<domain>/ `**tests**/ structure

Trade-offs Risk Assessment Hybrid Model Clarity Feature Horizontal layers system architecture Vertical user value Solo developer structure progress tracking Rework 7 services tests unchanged Action/UI layers 4x template velocity layer validated Rollback points phase Service layer stability Solo Horizontal predictability Vertical momentum progress cognitive overload modularity Risk exclusive Avoid service-to-service calls UI Service access ESLint rules code review checklist vertical slice needs action hook component More files horizontal Template scaffolding-Layer Action Service interface Hook signature Risk Breaking changes semantic versioning 8.2 Risk Matrix

Risk Likelihood Impact Severity Mitigation-to-Service Coupling** Action layer orchestration ESLint ban **Layer Boundary safety code review architecture tests-Engineering (Premature DRY Rule of Three-Time Memory Scheduler pattern cleanup tests E2E validation Duplication** Focus critical paths pyramid (60/30/10 **Delayed UI Vertical slicing Week 2 **Performance Degradation** Lighthouse CI bundle analysis code splitting Comparison Alternatives Overall Risk Time to MVP Solo Dev Fit ROI Recommendation **Path 6 weeks 12 weeks Not Recommended Horizontal 10 weeks Team Growth Path **Path (Hybrid 8 weeksVertical Pros cohesion delete 8 weeks duplication unclear boundaries HIGH Horizontal Pros enforcement Over-engineering rigidity 10 weeks MVP MEDIUM overhead formalization Model Pros trade-off 8 weeks MVP zero rework incremental risk discipline confusion

Governance Code Ownership 9.1 Ownership Model Ownership Infrastructure Architecture team Tech lead Requires cross-domain impact/shared/helpers Changes affect domains backward compatible Multi stakeholder approval Ownership (Domain Domain team Feature owner Domain-specific review/player/actions/player Changes domain minimal cross impact Domain expertise integration tests 9.2 Coupling Avoidance Strategies No Service-to-Service services/player/business createCasinoService app/actions/player-action ESLint custom rule code review checklist Prevents cascading dependencies Published Interfaces module import Module resolution rules index.ts exports Encapsulation versioning controlDependency BANNED Services creating clients createPlayerService supabase createClient GLOBAL STATE ALLOWED Factory accepting typed clients createPlayerService Type system Testability configuration control Anti BANNED Exposing raw database rows getPlayer<PlayerRow STRUCTURE EXPOSED ALLOWED Transform domain DTO getPlayer<PlayerDTO> DOMAIN MODEL PROTECTED Transform module per service Database changes don break contracts 9.3 Reuse Balance

Infrastructure Standard return clients Single source Shared React Query defaults Player validation schemas Visit lifecycle logic domain RatingSlip transforms MTL compliance rules bounded infrastructure isolate business logic

Success Metrics Monitoring Architecture Quality Indicators Target Measurement Frequency **Layer Boundary ESLint manual code review Coverage >80% reports Layer >90% <60s CI pipeline metrics 100% TypeScript compiler **ServiceResult 100% methods Code review checklist Policy 100% tables Manual schema audit 10.2 Development Velocity Indicators Target Frequency Domain 6 days Sprint velocity tracking Module >50% shared infrastructure Code analysis Execution <5min <15min Onboarding <4 hours first PR feedback Review <24 hours GitHub metrics \*\*Bug Escape <5% production Issue tracking Monthly 10.3 Health Indicators Layer Test pass rate 100% Test coverage >80%PRD violations file size >500 Module count >5 Layer 3) response time <500ms Cache rate >70% Error rate <1% over-invalidation

Layer React Query cache memory leaks render count >10 Real-time message rate storm Subscription cleanup orphaned channels Drift Service-to-service calls Layer boundary violations usage Global singletons

Adaptation Triggers Service Complexity file >500 lines >5 modules Evaluate feature slicing 10 operations Team >3 developers Formalize layer contracts Add ESLint rules stricter reviews Cross-Domain >3 services user Introduce orchestration layer workflow module Performance response time >500ms UI load >3s Evaluate caching optimize queries code splitting optimization real reduction Testing >10 minutes maintenance >20% dev time Re-evaluate testing pyramid integration tests reduce duplication 60% to 40% integration

Conclusion Recommendations Final Recommendation Model (Horizontal Layers Vertical Delivery Working 7 services 98 tests zero PRD violations First UI feature 3 weeks additions no rework Developer Horizontal structure vertical progress tracking Velocity 4x improvement gains 8 weeks MVP 12 weeks 10 weeks horizontal Implementation Principle layers technical architecture vertical feature delivery Technical Layers Data Layer Schema RLS migrations Service Business logic DTOs validation Action Server actions strategies UI Layer Components hooks Delivery Week 2-3 Complete Player Week 4-5 Visit 6 RatingSlip Next Steps Complete Service Add modules 7 services Integration testing Phase 2 audit Update_HANDOFF.md completion status Hybrid Create-003-hybrid-slicing-modelDecision Update_TEMPLATE module patterns_TEMPLATE.md server actions navigation Medium-Term Roadmap 2-8) 2-3 Management actions hooks UI E2E tests Real-time-tab synchronization Working Player Management

4-5 Tracking workflows-in cancellation history timeline 6 Third Slip Points calculation Performance metrics tracking 7 Real Infrastructure batch invalidation scheduler-time hooks Memory leak prevention UI synchronization 8 Production Cross-domain integration Bundle optimization code splitting Lighthouse CI gates Deployment pipeline automation Production-ready MVP Long-Term Evolution Strategy 1 1-3 MVP Real-time infrastructure Production deployment monitoring 2 4-6 Additional domains TableContext MTL Advanced features compliance Performance optimization scaling 3 Team growth adaptations Service complexity management architecture refinement Success Criteria 2 7/7 services 110+ tests coverage >80% Zero PRD violations 3 2-6)3 vertical slices Visit UI E2E tests Server actions <500ms latency React Query cache >70% 4 7) updates <1s Zero memory leaks Multi-tab synchronization subscription lifecycle 8) LCP TBT JS Zero security warnings Health check

Appendix A Example Domain A.1 Data Layer supabase/migrations_create_player CREATE TABLE player id UUID DEFAULT gen_random_uuid email NOT NULL "firstName NOT NULL "lastName NULL created updated ALTER TABLE player ENABLE ROW LEVEL SECURITY CREATE POLICY "Players viewable authenticated users POLICY "Players modifiable by staff.jwt Audit trigger CREATE TRIGGER player_audit_trigger UPDATE DELETE player ROW Updated timestamp trigger CREATE TRIGGER player_updated_trigger UPDATE A.2 Service Layer services/player/index.ts import SupabaseClient-js Database/types createPlayerCrudService createPlayerBusinessServiceimport createPlayerQueriesService from PlayerDTO PlayerCreateDTO PlayerStatsDTO/transforms ServiceResult from/shared/types export interface PlayerService getById Promise<ServiceResult create update delete activate<ServiceResult deactivate<PlayerDTO>> searchPlayers Promise<ServiceResult<PlayerDTO getPlayerStats Promise<ServiceResult export createPlayerService crudService businessService queriesService createPlayerQueriesService return ...crudService export type PlayerDTO PlayerCreateDTO PlayerUpdateDTO PlayerStatsDTO Action Layer/actions/player/create-player-actionserver import createServerClient createPlayerService/services/player revalidatePath/cache PlayerCreateDTO PlayerDTO/services/player ServiceResult/shared/types export async createPlayerAction PlayerCreateDTO<ServiceResult supabase createServerClient playerService result await playerService.create revalidatePath/players return result

A.4 Hook Layer hooks-player import useMutation useQueryClient/react-query createPlayerAction/actions toast PlayerCreateDTO/services/player export useCreatePlayer( queryClient useQueryClient return useMutation createPlayerAction queryClient.invalidateQueries queryKey.success created message result.error_EMAIL registered create player toast.error onError create player try again A.5 UI Layer components/player-formimport useForm from-hook-form zodResolver@hookform/resolvers/zod useCreatePlayer/hooks/player/use-create-player playerCreateSchema/services/player/validation type PlayerCreateDTO from@/services/player export function PlayerForm( mutate isPending = useCreatePlayer form useForm<PlayerCreateDTO> resolver(playerCreateSchema), defaultValues email firstName lastName onSubmit = (data: PlayerCreateDTO mutate(data); return <form onSubmit.handleSubmit.register(.formState.errors.email <button type="submit{isPending 'Creating... 'Create Player'

Appendix B ESLint Rules Enforcement.js module.exports Ban service-to-service imports-restricted-imports patterns-domain service imports forbidden Action layer orchestration Ban Supabase client creation services-syntax selector receive Supabase client dependency injection

Document Metadata 1.0 Architecture Team 2025-10-09 Recommended Adoption 2025-10-23 (2 weeks-prd_BLUEPRINT_MVP_PRD_LAYER_ARCHITECTURE_DIAGRAM-2/SERVICE_RESPONSIBILITY_MATRIX_LAYERING_ANALYSIS_SLICING_PHILOSOPHY_MIGRATION_ANALYSIS
