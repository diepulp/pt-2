Controlled Hybrid Refactor TDD PT-1 mining Phase 2 Active

Three-Phase Approach Purpose Output TDD validate PT-2 patterns() flows RLS guardrails Revisit PT-1 constructs logic query joins error mapping Re-implemented modules PRD-compliant debt-free Capture pattern `SERVICE_TEMPLATE.md

Operational Guardrails relapse PT-1 migration Rule of Three refactor repeated three create/shared/validation.ts 3 services same validation pattern One-Violation Rule PT-1 artifact breaks PRD clause rewrite Violations `ReturnType `supabase/database-rebuilt imports@deprecated code BaseService abstractions code contains don't import Time-Box Mining PT-1 exploration â‰¤4 hours per module longer rebuild debugging legacy debt new features End-of-Week Audit audit checklist legacy imports ReturnType inference_TEMPLATE Document Code JSDoc before ADRs prevents drift Creates new player duplicate email detection creation ServiceResult DUPLICATE_EMAIL error.create firstName lastName consoledata

Implementation Timeline Week 1: Player Service TDD() Shared infrastructure Test suite foundation(() operations Duplicate email update validation CRUD cycle scoring queries Rewrite Database types interfaces Test borrowed patterns Integration tests End-week audit checklist_TEMPLATE.md finalization Player service reusable template Week 2: Visit Service Apply Player template operations end cancel State transition validation Business logic management Queries visits history Integration tests Week 3: RatingSlip Service patterns TDD rating calculations Point accrual Table/seat assignment Status transitions Integration tests

Success Metrics Target Measurement **PRD 100% 0 violations end-of-week audit **Velocity +50% Week 2-3 vs Week 1 60% Template usage >80% 100% passes

Risk Mitigation Pattern Drift patterns template review PT-1 Contamination Legacy imports End-of-week audit lint rules Over-Engineering abstractions Rule Three Under-Documentation stale Document-as-code weekly updates

Hybrid vs TDD Controlled hybrid PT-1 search patterns (18 months TDD wheels (20-30h waste technical debt (12-16h cleanup balances quality velocity migration creep Time-Box Mining 4 Hours limit PT-1 exploration >4h complex Rebuilding faster sunk-cost fallacy miss optimizations Template Before Slice 2 Lock pattern Slice 1 validates refinements 2-3

model Zero debt learning internalizes 50% faster services template Template evolves Week 1: 18h Week 2-5 4 services 12h 48h 72h TDD 24 hours Phase 2

Related Documents_TEMPLATE.md Canonical implementation pattern_BLUEPRINT_MVP_PRD.md Architecture requirements_LAYER_ARCHITECTURE_DIAGRAM.md System design-vertical Implementation plan
