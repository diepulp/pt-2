Phase 5 Tracking READY EXECUTION 4 (22/22 tests 100% quality 11-15 hours ENABLED 2 3

Phase 5 Tracking casino player management follows Phase 4 pattern enhanced parallel delegation Success Metrics tests 28 quality gates ~2 hour execution Zero rework

Prerequisites Verification Database Schema (VERIFIED Table`sql visit id player_id casino_id check_in_date check_out_date status VisitStatus (ONGOING COMPLETED CANCELED mode VisitMode (RATED UNRATED `VisitStatus ONGOING COMPLETED CANCELED `VisitMode RATED UNRATED Service Layer (VERIFIED [services/visit/ `create VisitCreateDTO ServiceResult `getById(id string string Methods `delete(id string ServiceResult(filters VisitFilters(query string Infrastructure (VERIFIED Action Wrapper**/server-actions/shared/-service-query.ts-service-mutation.**Database Types\*\*/database.ts/database

Wave Structure Parallel Delegation Wave 1: Service Layer Extensions (1h Backend Architect Sequential 2: Server Actions Query Hooks Actions 1.5h Query Hooks 1h signatures 3: Mutation Hooks UI Components (5h 1.5h UI Components 3.5h mock data 4: E2E Tests Full-Stack Developer Sequential

Wave 1: Service Layer Extensions 1 hour Backend Architect Sequential Wave 2) Objective Extend visit service missing CRUD methods match Phase 4 player service Deliverables Update [services/visit/crud.ts Delete visit ID async<ServiceResult executeOperation"delete async error await supabase.delete Check FK violation records.code_KEY delete visit related records List visits optional filters VisitFilters playerId casinoId status mode async<ServiceResult<VisitDTO executeOperation async query supabase player_id casino_id check_in_date check_out_date mode_in Apply filters.playerId query.eq.casinoId query.eq("casino await query throw error return data Search visits player info (requires join async (query Promise<ServiceResult<VisitDTO return executeOperation_visits", async data error await supabase.select id player_id casino_id check_in_date check_out_date mode status player_id (firstName lastName email.firstName"check_in false throw error return data Update [services/visit/index**Update export interface VisitService create<ServiceResult<VisitDTO>> getById update<ServiceResult delete<void>> list<ServiceResult<VisitDTO search(query Promise<ServiceResult<VisitDTO **Export new export VisitFilters

Quality Gates (6) methods typed interfaces Error FK violations NOT_FOUND executeOperation wrapper SupabaseClient typing JSDoc comments methods inference Validation Commands check npx Service tests

Wave 2: Parallel Track Server Actions Query Hooks 2.5 hours (1.5h + 1h overlapping Track A â†’ B starts 30min A Track A Server Actions (1.5h Backend Architect [app/actions/visit-actions.ts Deliverables Create 6 server actions Phase 4 pattern import createClient createVisitService withServerActionWrapper VisitCreateDTO VisitUpdateDTO VisitFilters Create new visit creation data ServiceResult async createVisit createClient Update existing visit ID update data ServiceResult updateVisit VisitUpdateDTO createClient createVisitServiceupdate(id Delete visit by ID id ServiceResult export async function deleteVisit(id return withServerActionWrapper supabase createClient service createVisitService return service.delete single visit by ID Visit ID ServiceResult export async function getVisit(id supabase createClient createVisitService.getById List visits optional filters filters Optional filter criteria ServiceResult function getVisits createClient createVisitService Search visits by player information query query string ServiceResult async function searchVisits(query string supabase createClient createVisitService return service.search

Quality Gates (6) actions Comprehensive JSDoc functions error handling wrapper Type-safe service integration No business logic actions Consistent naming Track B Query Hooks (1h TypeScript Pro [hooks/visit Needs server action signatures Track A (30min delay Deliverables 3 query hooks ADR-003 patterns [hooks/visit/use-visit.ts useServiceQuery getVisit/actions Query hook single visit ID visitId Query result data export useVisit useServiceQuery getVisit 5 60 minutes [hooks/visit/use-visits.ts useServiceQuery-service import getVisits/actions VisitFilters Query visits optional filters filters Optional filter criteria Query result visits array export useVisits useServiceQuery getVisits staleTime 2 \* 60 1000 minutes/visit-search import useServiceQuery searchVisits/actions/visit Query searching visits player information query Search query string Query result matching visits export useVisitSearch(query useServiceQuery searchVisits.length 2 search 2+ characters staleTime 30 1000 seconds

Quality Gates (4) hooks template keys hierarchical pattern staleTime case Enabled conditions prevent fetches

Wave 3: Parallel Track Mutation Hooks UI Components 5 hours (1.5h 3.5h Track A B simultaneously Track A Mutation Hooks TypeScript Pro [hooks/visit 3 mutation hooks ADR-003 invalidation strategies/visit.ts Domain-level invalidation useServiceMutation createVisit VisitCreateDTO Mutation hook new visit React Query mutation create functionality useCreateVisit Invalidate visit queries created/visit-update-visit.ts Granular invalidation useServiceMutation-service import updateVisit/actions import VisitUpdateDTO/services Mutation hook updating visit visitId update Query mutation update functionality export useUpdateVisit(visitId return useServiceMutation VisitUpdateDTO updateVisit(visitId invalidateKeys visitId Specific visit list queries search queries successMessage "Visit updated/visit/use-visit Query removal import useServiceMutationimport deleteVisit/actions Mutation hook deleting visit visitId delete React Query mutation delete functionality export useDeleteVisit(visitId return useServiceMutation deleteVisit invalidateKeys list Remove cache "Visit deleted Quality Gates (4) hooks template invalidation strategies/granular Success messages TypeScript inference Track B UI Components (3.5h Full-Stack Developer/visits

start mock data integrate hooks later Create 4 React components Phase 4 patterns 1. [app/visits/visit-list.tsx Table display visits Status badges COMPLETED CANCELED Mode badges UNRATED Filter dropdowns Real search 300ms debounce Automatic hook switching Loading states Action buttons View Edit Delete Results count display `useVisits(filters(query import useState useDebounce useVisits useVisitSearch VisitFilters export VisitList( useState debouncedQuery useDebounce hook switching debouncedQuery.length 2 listQuery useVisits 2. [app/visits/visit-form.tsx/visits-form Dual mode Create Edit-hook-form integration Required fields playerId casinoId checkInDate Optional checkOutDate status mode Player Casino selector Date pickers `isDirty tracking disable submit changes Success/error message Form reset submission Loading Cancel button/visits/visit information Player info Casino info Visit timeline-in duration Status mode badges Related records slips rewards Loading-found states buttons Edit Delete End Back List navigation/visits-dialog

Radix UI AlertDialog Confirmation message visit details Loading deletion error violations delete Accessible markup Auto-close success animations React 19 TypeScript Tailwind CSS react-hook-form Radix UI components Input Label Card Select Badge Quality components TypeScript loading states Tailwind styling WCAG 2.1 accessibility compliance react-hook-form validation Hook integration console errors TypeScript errors

Wave 4: E2E Tests 2.5 hours Full-Stack Developer/e2e previous waves complete Deliverables-management-integration**Test Suites** (minimum 20 tests):"Visit Management - Integration Tests","Create Workflow", create new visit validate required fields", handle player not found casino not found default to ONGOING status UNRATED mode","Read Workflow", fetch visit by ID", list visits ordered by check-in filter visits by status", by search visits by player return empty array when no visits"Update Workflow", update visit visit set check-out date (end visit reflect updates in"Delete Workflow", delete visit handle FK violation (related rating slips remove from cache after deletion","Complete Lifecycle", handle full visit lifecycleupdate end async => {"Performance", load visit list < 1 async { search visits < async { Validation", enforce valid status async { mode {"Error handle invalid player ID { invalid casino ID {

2. [cypress/e2e/visit-management.ts] **E2E Browser Tests** (minimum 15 tests): describe"Visit Management - E2E",/visits"Visit"displays visits table"filters by status mode"searches by player"shows correct status badges","Create Visit","opens create form"selects player from casino"validates required fields","creates visit shows"Edit Visit","opens edit form"updates visit"ends visit (sets check-out date"Delete Visit","opens confirmation"cancels deletion","confirms deletion removes from 3. [cypress/support/commands.ts]( **Add Custom Commands**: Create test visit Cypress.Commands.playerId casinoId status mode Generate test visit data Cypress.Commands playerId casinoId checkInDate status mode Quality Gates (6) tests passing (20+ 15+ Cypress Test coverage > 85% domain Performance benchmarks< 1s list < 300ms search No flaky tests (3 consecutive runs pass Test cross-test dependencies Comprehensive error scenario coverage Validation Commands integration tests-management Watch mode Coverage Cypress/e2e/visit-management.cy

Parallel Delegation Strategy Agent Coordination Matrix Duration Dependencies Backend Architect 1h Server Actions 1.5h Query Hooks TypeScript Pro 1h 2A (30min Mutation Hooks TypeScript Pro 1.5h UI Components Full-Stack Developer 3.5h E2E Tests Full-Stack Developer 2.5h 3 Execution Timeline 0:00 Wave 1: Service Extensions Architect 1:00 2A Server Actions 3B UI Components 1:30 2B Query Hooks Pro 2:30 3A Mutation Hooks Pro 3B UI hooks 4:00 UI 4:30 4: E2E Tests-Stack Developer 7:00 Elapsed ~7 hours 11h sequential 36% time savings Communication Protocol 2A Wave 2BServer Action Signatures createVisit getVisit searchVisits(query string start Wave 2B (Query Hooks 2A â†’ 3A Server Actions create update delete get list search wrapped JSDoc documentation start Wave 3A (Mutation Hooks 3A â†’ 3B Mutation Hooks

Full-Stack hooks Wave 3B

Quality Gate Gates 28 Service Extensions Explicit types error handling Server Actions Wrapper JSDoc error handling Query Hooks staleTime Mutation Hooks invalidation strategies UI Components TypeScript styling accessibility E2E Tests Coverage performance no flakiness 28 gates passed

Risk Mitigation Phase 4 Schema verified Supabase MCP structure Layer 1 adds missing methods paths verified against codebase timestamp data cleanup 3-run verification Phase 5 Risks/Casino FK players casinos players create fixtures Status State Invalid state transitions validation test transitions Records delete visits rating slips rewards FK violation testing error messages

Success Functional 6 server actions 6 hooks 4 UI components 20+ Jest tests 15 Cypress tests Quality 28 gates Test coverage 85% Zero TypeScript errors WCAG 2.1 accessibility compliance Performance List load 1 second Search response 300ms Create 200ms Test suite execution 1 second

Post-Wave Documentation Completion Checklist wave document Wave X Signoff COMPLETE passed

Deliverables File 1 2 updated Tests

Validation Commands npm test

Issues None issues resolutions

Next Wave X+1 start Final Phase Completion Report_REPORT Phase 4 template

Reference Commands Development Start server Production build type-check TypeScript validation Testing test Run tests mode:coverage coverage cypress open GUI run headless Specific Tests test-management-integration.test cypress run Database:types Regenerate database types

Appendix Definitions VisitDTO interface id player_id casino_id check_in_out_date status "ONGOING "COMPLETED mode "RATED VisitCreateDTO playerId casinoId checkInDate mode "RATED status "ONGOING VisitUpdateDTO checkOutDate mode "RATED status VisitFilters playerId casinoId status "ONGOING "COMPLETED "RATED Ready execution High Phase 4 success Total 7 hours parallel delegation 11-15 hours (sequential
