Week Player Management 2025-10-12 State Management 4 Player Wave parallel 2 15.5 hours 1.5h

Week 4 Player Management Week 3 infrastructure CRUD capabilities Implement player management workflow Validate Week 3 infrastructure Establish patterns Weeks 5-6 Achieve >90% test coverage create read update delete players 17 hours 15.5 hours 1.5 hours improvement Week React Query Server action wrapper Hook templates Player service validated Query patterns Cache invalidation strategies

Week 4 Wave Summary Quality Gates Server Actions 4h Backend Architect 6 Query Mutation Hooks 1.5h TypeScript 8 gates UI Components 6h-Stack Developer 8 E2E Tests 4h 15.5 hours 28 quality gates 1 parallelization

Wave 1: Server Actions (4 hours SEQUENTIAL Execution Mode Foundation layer solid Agent Assignment Expert server-side logic error handling database operations Task 1.1 Implement Player Server Actions 4 hours `app/actions/player-actions.ts lines `createPlayer `deletePlayer `searchPlayers File app/actions/player-actions.ts import createServerClient withServerAction createPlayerService Database CreatePlayerDTO PlayerFilters/types Create new player VALIDATION_ERROR data invalid UNIQUE_VIOLATION if player_code exists export createPlayer withServerAction CreatePlayerDTO supabase createServerClient service createPlayerService service.create operationrequireAuth true Update player NOT_FOUND if exist VALIDATION_ERROR if data invalid updatePlayer withServerAction async string UpdatePlayerDTO createServerClient createPlayerService service.update(id.update requireAuth true Delete player NOT_FOUND exist FOREIGN_KEY_VIOLATION dependent records deletePlayer withServerAction string createServerClient createPlayerService service.delete.delete requireAuth true Get player by ID NOT_FOUND if exist getPlayer withServerAction string createServerClient createPlayerService service.getById.read requireAuth true

Get players optional filters Supports filtering casino_id rating active status export getPlayers supabase createServerClient Search players by name player_code Full-text search export searchPlayers createServerClient Handling VALIDATION_ERROR Invalid data UNIQUE_VIOLATION Duplicate player_code FOREIGN_KEY_VIOLATION Delete dependencies NOT_FOUND Player INTERNAL_ERROR Unexpected failures Unit tests each action Integration tests database Error scenario coverage 5 types Performance validation<500ms per operation 6 server actions implemented action wrapped `withServerAction Error mapping validated TypeScript types match service layer Unit tests>90% coverage Integration tests DB Week 3 wrapper/actions-server-action-wrapper Player service Service types` Database types/types

Wave 2: Query Mutation Hooks hours PARALLEL Two tasks Parallelization tasks consume same input No inter-dependencies query mutation hooks follow templates TypeScript Pro patterns Quality gates validated independently 3h sequential 1.5h parallel hours Task 2.1 Query Hooks (1.5 hours PARALLEL TypeScript Pro #1/player/use-player Single player query List query filters-search Search query Week 3 File/player import useServiceQuery getPlayer type Player export usePlayer(id useServiceQuery getPlayer staleTime 1000 _ 60 _ 5 minutes ADR-003import useServiceQuery/hooks/shared getPlayers/actions Player PlayerFilters/services/player/types export usePlayers return useServiceQuery<Player getPlayers staleTime 1000 _ 60 _ 2 2 minutes lists File hooks/player-search import useServiceQuery/hooks/shared searchPlayers/actions/player-actions type Player/services/player/types export usePlayerSearch(query string useServiceQuery<Player searchPlayers query.length >= 2 search 2+ characters staleTime 1000 \* 30 30 seconds \*\*Query Key ADR Detail List filters Search query

(4) 3 query hooks implemented keys follow pattern TypeScript inference works Hooks integrate useServiceQuery template Task 2.2 Mutation Hooks hours PARALLEL TRACK TypeScript Pro #2/player-create-player Create mutation-player Update-player Delete Week 3 File/player-player import useServiceMutation createPlayer useQueryClient-query CreatePlayerDTO export useCreatePlayer( queryClient useServiceMutation CreatePlayerDTO Strategy 1: Domain-level invalidation ADR-003 queryClient.invalidateQueries queryKey hooks/player-update-playerimport useServiceMutation/hooks/shared updatePlayer/app/actions/player-actions useQueryClient@tanstack/react-query UpdatePlayerDTO/services/player/types export useUpdatePlayer(playerId queryClient useServiceMutation UpdatePlayerDTO updatePlayer Strategy 2: Granular invalidation ADR-003) queryClient.invalidateQueries invalidate lists updated data File hooks/player/use-delete-player import useServiceMutation/hooks/shared deletePlayer/app/actions/player-actions useQueryClient@tanstack/react-query export useDeletePlayer(playerId string queryClient useServiceMutation<void deletePlayer Strategy 3: Query removal ADR-003) queryClient.removeQueries Invalidate lists reflect deletioninvalidateQueries queryKey'player Invalidation ADR Domain-level invalidation'player Granular invalidation'player id lists Query removal list invalidation

3 mutation hooks Cache invalidation TypeScript generics variables data template Wave 2 Coordination 1 complete server actions tested validated Launch TypeScript Agent #1 #2 agents 1.5 hours 6 hooks implemented (3 query 3 mutation report success Quality gates validated No merge conflicts Wave tracks complete 8 quality gates passed

Wave 3: UI Components (6 hours SEQUENTIAL Execution Mode Components cohesive Agent Assignment-Stack Expert React UI/UX component integration NOT Parallelized Components share state management patterns Design consistency single agent Form/List integration coordination Dialog components depend List/Detail context Risk rework time savings Task 3.1 Player UI Components (6 hours 6-list List view search/filter-form Create form Detail view-delete-dialog Delete confirmation PlayerList Component (2 hours) import useState usePlayers PlayerFilters export PlayerList( query filtered list usePlayerSearch usePlayers input setSearchQueryvalue placeholder="Search players..." Filters Casino rating type active status toggle Loading/Error states {isLoading {error.message Player table {players.map(){player.id.player_code.first_name.last_name.current_rating.casino_id handleView(player.id handleDelete **Features** Real-time search debouncing (300ms Filter by casino rating type active status Pagination support (20 per page Loading states error handling Action buttons (view edit delete 2. PlayerForm Component (2 hours File app/players/player-form.client import useForm-hook-form useCreatePlayer/hooks/player-player useUpdatePlayer-update import type CreatePlayerDTO Player/services/player/types

PlayerFormProps player Player editing onSuccess => void export function PlayerForm( player onSuccess PlayerFormProps isEditing = !!player createPlayer isCreating useCreatePlayer(); updatePlayer isUpdating useUpdatePlayer(player.id register handleSubmit formState errors useForm<CreatePlayerDTO> defaultValues: player player_code first_name last_name_name other fields onSubmit = CreatePlayerDTO updatePlayer(data onSuccess Show success toast onError Show error toast error.message createPlayer(data onSuccess Show success toast onError error toast return <form onSubmit{handleSubmit>Player(\_code required true {errors.player_code required true>Last required true {errors.last_name name Additional fields casino_id initial_rating rating_type <button type="submit disabled{isCreating isUpdating 'Update Player 'Create Player Form validation react-hook-form Create edit modes Error handling messages Loading states submission Success/error notifications 3. PlayerDetail Component (1 hour File app/players/player-detail.tsx import usePlayer/use-player interface PlayerDetailProps playerId string export function PlayerDetail( playerId PlayerDetailProps data player isLoading error usePlayer(playerId); (isLoading return player.message not.first_name.last_name>Current_rating_id.total_visits.deleted 'Inactive 'Active Date(player.created(}</dd>> <div> <button handleEdit(player.id handleDelete </div>

Display player information Loading error states Action buttons (edit delete Formatted dates status PlayerDeleteDialog Component (1 hour File app/players/player-delete-dialog.tsx import useDeletePlayer type Player/services/player/types PlayerDeleteDialogProps boolean onClose void onSuccess void export function PlayerDeleteDialog onClose mutate deletePlayer useDeletePlayer(player handleDelete(undefined onSuccess Show success toast onError error toast violation player related records return null delete.first_name action undoneCancel Player Confirmation dialog player name Loading deletion Error handling FK violations Accessible dialog markup Wave 3 Quality Gates 4 components hooks Loading error Form validation Search filter functionality UI/UX consistent Accessibility standards keyboard No TypeScript compilation errors Follow PT-2 design patterns Tailwind CSS responsive layouts Ensure accessibility 2.1 Level AA

Wave 4: E2E Tests (4 hours SEQUENTIAL Mode Validates complete stack requires previous waves Agent Assignment-Stack write comprehensive E2E tests Task 4.1 E2E Test Suite (4 hours 4 hours `**tests**/e2e/player-management.test.ts Complete CRUD workflow tests Coverage File/e2e/player-management.test.ts@playwright/test Management E2E createdPlayerId Navigate players page Ensure authenticated Player Workflow player Click create button Fill form_code-001_type Submit Verify success created Verify listlocator=TEST-001 show validation errors invalid data async page.click-testid="create-player-btn.click Submit empty form.locator=Player code required name required handle duplicate player code error async Create first player createTestPlayer 'DUP-001 create duplicate createTestPlayer.locator code exists Player Workflow display player list players async Verify table rendered Verify columns.locator view player details async Click player page.click-testid="player-TEST-001 Verify detail view Doe")locator=TEST-001 search players name Type search page.fill-search Wait debounce Verify filtered results.locator Doe filter players casino Select casino filter.selectOption-filter-123 Verify filtered results page.locator expect(rows).toBeGreaterThan(0)

Player Workflow update player successfully async page Click edit button page-testid="edit-player-TEST-001 Update field page.fill[name="first_name 'Jane page[type="submit Verify success updated Verify detail=Jane Doe handle validation errors update async page.click-player-TEST-001 page.fill[name="first_name" page[type="submit name Player Workflow delete player Click delete button page-player-TEST-001 Confirm dialog page-delete Verify success deleted Verify removed list.locator=TEST-001 cancel deletion async page pageclick-testid="delete-player-TEST-001 page-delete Verify list.locator=TEST-001 handle FK violation error Create player related records (visit rating createPlayerWithVisit-TEST delete-testid="delete-player-FK-TEST-delete Verify error message=Cannot delete player related records CRUD Workflow complete full player lifecycle Create createTestPlayer 'LIFECYCLE-001.locator created Read page.click-testid="player-LIFECYCLE-001.locator Update page-testid="edit-player page.fill page updated Delete page-testid="delete-player page-deletedeleted Tests load player list 2 seconds async startTime Date page/players loadTime Date test search <500ms response time async page.fill-search startTime Date.waitForTimeout Debounce.waitForSelector searchTime Date startTime expect(500); (5 tests Successful creation Validation errors Duplicate player code Casino assignment Initial rating setup

(4 players Search Filter (3 Successful Validation errors UI updates (3 Successful deletion Cancellation FK violation (1 lifecycle read update delete (2 load <2s Search response <500ms 18 E2E tests Wave 4 Quality 18 E2E tests Performance benchmarks Error scenarios validated Accessibility No critical bugs

Week 4 Metrics Time Efficiency 17 hours 15.5 hours 1.5 hours (9% improvement Wave 2 Mutation hooks Deliverables Summary Category Files Server Actions Query Hooks 3 Mutation Hooks UI Components 4 files form dialog E2E Tests 18 1 file-management.test Quality Metrics 28 Coverage >90% Server actions <500ms List load <2s Search response <500ms WCAG 2.1 Level AA compliance Code Metrics ~250 lines ~450 lines ~800 ~600 lines ~2,100 lines

Success Criteria Functional Requirements create view list search filter casino view details update delete CRUD operations validated Technical Requirements vertical stack DB Service Action Hook UI server actions hooks templates Week 3 Query keys ADR-003 patterns Cache invalidation strategies Error handling TypeScript safety No compilation errors Quality Requirements >90% test coverage 28 quality gates passed 18 E2E tests Performance targets Accessibility standards No critical bugs Documentation Requirements Wave signoff Component usage Hook patterns Lessons learned

Challenges Mitigations Form Validation Complexity form react-hook-form Zod schema validation reuse DTOs service layer Search Performance datasets slow debouncing database indexes full-text search Cache Invalidation Complex invalidation Follow ADR-003 patterns test E2E tests FK Violation Error Messages Parse codes-friendly messages 5 Component Interdependencies Components coupled test composition patterns pass callbacks mock hooks

Inter-Wave Dependencies Wave 1: Server Actions 6 Wave 2: Hooks Query Mutation 6 hooks (3 query 3 mutation 3: UI Components 6 hooks 2 4 React components 4: E2E Tests stack 1-3 18 E2E tests Wave 1 2 3 4 Waves 1 3 4 Wave 2 mutation hooks

Agent Execution Instructions Backend Architect 1)-wrapper wrapper interface DTOs Implement 6 server actions-actions unit tests service layer integration tests database Validate 6 quality gates Create Wave 1 document TypeScript Pro 2 Query Hooks-query-strategy query-actions server actions Implement 3 query hooks Follow query key patterns Validate TypeScript inference 4 quality gates Report completion TypeScript Pro #2 2 Mutation Hooks-mutation-strategy invalidation strategies-actionsserver actions Wave 1) Implement mutation hooks cache Validate TypeScript generics 4 quality gates Report completion Full-Stack Developer 6 hooks 2 PT-2 Tailwind configuration Implement 4 UI components PlayerList loading states accessibility standards Validate 8 quality gates Create Wave 3 Developer components 3 Playwright test environment Implement 18 E2E tests Create Read Update Delete Complete Performance Validate performance benchmarks 6 quality gates Create Wave 4 Week 4

Reference Documentation Week 3 Infrastructure [ADR-003 State Management Strategy [Hook Templates README [React Query Setup Action Wrapper [Week 3 Completion Signoff Service Layer Service Types Template Architecture Standards [Balanced Architecture Quick Responsibility Matrix [MVP Production Roadmap

Lessons Week 3 Week 4 Worked Week 3-based Clear structure track progress tasks Wave Saved 6 hours no conflicts issues problems-based data better ADR-003 729-line README confusion Week 4 wave 4 waves clear boundaries Wave Query mutation 1.5 hours quality Comprehensive validation stack workflow guidance Week 3 Challenges Addressed validated service types Database schema surprises code handles codes Integration tests validated relationships

Pre-Flight Checklist Week 4 Infrastructure Ready React Query configured Server action wrapper tested Hook templates Player service validated tests Database types Documentation Ready ADR-003 finalized Hook README 30 query patterns Week 3 completion workflow document reviewed Environment Ready Development environment Database Test data Playwright E2E tests Team Ready Backend Architect TypeScript Pro Full-Stack Developer 3-4 Quality gates

Progress Tracking Wave Completion Checklist 1 Server actions tested quality gates passed 2 6 hooks parallel tracks quality gates passed 3 4 components quality gates 4 18 E2E tests performance quality gates Signoff Documents Server actions Hooks UI components E2E tests_4_COMPLETION week summary

Steps Week 4 4 1 Week 5) Review Week 4 lessons Update patterns Begin Week 5 Visit Tracking Feature Apply wave structure improvements Week 5 Preview Visit Tracking Feature server actions hooks UI components tests 16 hours Week 4)

Links Implementation Files Server Actions-actions Query Hooks-player Mutation Hooks Components\* E2E Tests-management.test.ts Documentation Workflow-3/WEEK ADR-003-management-strategy Hook README Week 3 Signoff_SIGNOFF Support Slack#phase-3-implementation GitHub Questions workflow Final 2025-10-12 1.0 After Wave 2 parallelization

Week 4 Execution Architect 6 actions TypeScript agents query mutation hooks 4 UI components 18 E2E tests 15.5 hours 1.5 hours 28 12 files CRUD functionality >90% test coverage quality gates passed
