Phase 3 UI State Management 3-6 Hybrid Architecture Ready

Phase 3 UI full-stack architecture PT-2 MVP architecture 3 shared state management infrastructure 4-6 feature stacks domain per week Decision_ARCHITECTURE 4-second rule domain VERTICAL

Phase 3 Complete state management foundation Deliver 3 feature slices UI E2E test Document decisions 3 features functional DB Service Action Hook UI E2E <100ms >90% E2E test pass Zero TypeScript errors

Architecture Strategy Hybrid Model Infrastructure domains React Query services Server action wrapper UI stores Hook templates features Integration tests services 4-6 feature delivery domain Player Management Visit Tracking RatingSlip Creation 6) Week 3 enables Week 4-6 user value cross-domain coupling Refactoring AFTER delivery

Week 3: HORIZONTAL Foundation State management infrastructure vertical feature delivery Tasks React Query Setup (4 hours/query-client/layout.tsx-client PT-2 defaults queryClient 1000 60 retry Create/query.ts defaults Add `QueryClientProvider root layout Configure React Query DevTools Test query React Query provider root DevTools:3000 No console errors startup Server Action Wrapper (3 hours/actions-action-wrappererror handling logging validation export async<T Promise userId Promise<Result Validation error mapping audit logging Create server action wrapper error handling Implement error mapping violations validation errors Add audit logging production Test sample service Player Wrapper tested 1 service Error mapping covers DB errors unique NOT_FOUND Audit logs_log table Zustand UI Stores (2 `store/ui-store.ts-store.ts Ephemeral UI state navigation filters useUIStore Create/ui-store.ts global UI state/player-store.ts player-specific UI state Document Zustand Test modal open/close workflow

UI stores handle modal navigation filter state No server data Query owns Stores documented examples 4. Query/Mutation Hook Templates (3 hours-query-mutation Template service queries await queryFn.data Create-service-query.ts-mutation.ts Document query key pattern entity id example usage README Templates handle Result<T React Query mapping Query keys follow consistent pattern Documentation examples 7 services 5. Integration Smoke Tests (4 hours/services-smoke.testValidate 7 services Integration create player visit rating slip Cross-service workflow test Create test suite 7 services Test cross-service dependencies Validate referential integrity Document integration issues 7 services pass CRUD tests Cross-service workflows validated No integration errors ADR-003 State Management Strategy (2 hours React Query defaults retry Query key entity id Invalidation strategy Ephemeral UI React Query owns Draft ADR-003 Include examples Review team Finalize commit ADR-003 approved state management decisions documented Examples common scenarios

Week 3 components delivered React Query Server action wrapper stores Hook templates Integration tests 7 services tests ADR-003 finalized DevTools No TypeScript errors Documentation 18-20 hours days 4 hours

Week 4: Player Management Complete Player Management feature full UI Feature Stack Layers Layer 1: Server Actions (4 hours) `app/actions/player-actions.ts createPlayerAction supabase createClient.createPlayer Create/actions/player-actions.ts Implement searchPlayers Use server action wrapper Test action Supabase client CRUD operations functional Error handling Audit logging enabled Layer 2: Query Hooks (3 hours)/player/use-player.ts-players usePlayer(playerId getPlayerAction Create-player.ts-players.ts pagination-player-search.ts name/phone Test hooks React Query DevTools standardized query key pattern Loading/error states handled correct cache behavior Layer 3: Mutation Hooks (3 hours/player/use-create-player-update-player.ts export function useCreatePlayer( return useServiceMutation createPlayerAction queryClient.invalidateQueries( queryKey Create-create-player.ts-update-player-player.ts Implement cache invalidation success Mutations trigger cache invalidation Optimistic updates better UX Error states handled Layer 4: UI Components (6 hours/player/player-list.tsx-form.tsx export function PlayerList() usePlayers( createPlayer useCreatePlayer( implementation Create-list.tsx search/filter-form.tsx validation-detail.tsx actions-delete-dialog.tsx (confirmation

Users view create edit delete Layer 5 E2E Tests (4 hours/player-crud.spec.ts test create view edit delete Create E2E test creation editing deletion search filter E2E tests passing >90% code coverage No flaky tests Week 4 Success Criteria Full Player Management DB Service Action Hook UI create view edit delete Search filter E2E tests passing TypeScript compilation No console errors RLS policies validated Performance <100ms hook 20 hours (5 days 4 hours/day

Week 5 Visit Tracking Complete Visit Tracking full UI Stack Layers 1: Server Actions (4 hours/actions/visit-actions Create Implement server action wrapper Test visit lifecycle Visit lifecycle working Active visits queryable Business logic enforced (1 active visit per player Layer 2: Query Hooks (3 hours Create-visit-history Test hooks React Query DevTools standardized query key pattern Real-time updates visits change Loading/error states handled Layer 3: Mutation Hooks (3 hours-start-visit-visit Create Implement cache invalidation success Mutations trigger cache invalidation Visit list updates mutations Error states handledplayer active visit Layer 4: UI Components (6 hours-form-list Create-form player selection-list visits table-status badge-visit-dialog confirmation start visits view visits end visits timestamp cancel visits Layer 5 E2E Tests (4 hours-lifecycle.spec Create E2E test start workflow end workflow cancel workflow business logic (1 active visit per player

E2E tests Visit lifecycle Business rules Week 5 Visit Tracking DB Service Action Hook UI start view end cancel visits real-time E2E TypeScript No console errors RLS policies Performance <100ms 20 hours (5 4 hours

Week 6 RatingSlip Creation Complete RatingSlip Management UI Stack Layers 1: Server Actions (4 hours-slip Create Implement getRatingSlipsByPlayer server action wrapper Test rating slip creation point calculations slip CRUD operations functional Point calculations validated Integration MTL service Layer 2: Query Hooks (3 hours Create-rating-slip fetch history-summary totals Test hooks React Query DevTools standardized query key pattern data calculated points Loading Layer 3: Mutation Hooks (3 hours-slip-create-rating-slip-create-rating-slipImplement cache invalidation Test mutation error handling Mutations trigger cache invalidation Player rating history updates mutations Error states errors FK violations Layer 4: UI Components (6 hours-slip-form Create-form-list-display points breakdown-summary point totals create rating slips view player rating history Point calculations edit rating slips Layer 5 E2E Tests (4 hours-slip-workflow Create test Test editing workflow point calculation accuracy integration visit player data

E2E tests Point calculations Integration Week 6 RatingSlip Management DB Service Action Hook UI create edit slips Point calculations E2E tests TypeScript No console errors RLS policies Performance <100ms 20 hours (5 4 hours

Quality Gates Validation-Week 3 React Query provider Server action wrapper service Hook templates 7 services tests ADR-003 approved DevTools 4-6 DB Service Action Hook UI stack CRUD operations UI E2E tests TypeScript compilation errors RLS policies Performance targets<100ms hook Cross-Cutting Quality Standards No `any types server actions return<T> Database types Hook execution <100ms Query response times <200ms No re-renders RLS policies zero critical issues Server actions validate permissions >90% E2E test pass rate user workflows No flaky tests CI pipeline

ADR ADR-003 State Management Strategy 3) Required Week 4 React Query key Cache invalidation scope Server data ownership ADR-004 Real-Time Strategy 6) Required features cache invalidation batch scheduler Memory leak prevention Domain-specific channels shared Reconnection handling Subscription cleanup ADR-005 Security Patterns 7) Required production deployment RLS policy JWT claim validation Audit logging Rate limiting sensitive operations Input validation sanitization

Metrics Progress Tracking HORIZONTAL 3) components React Query Server action wrapper Zustand stores Hook templates Integration tests Server action wrapper Hook template Test 7 services validated VERTICAL Metrics 4-6 features Player Management Visit Tracking RatingSlip Creation-Feature E2E test coverage workflows User-facing functionality operations Performance Hook execution times Progress Tracking Update TodoWrite task type-check Test functionality Update/phase-2/SESSION_HANDOFF.md Run security advisor address issues Commit changes HORIZONTAL Review metrics adjust timeline Phase Update_PRODUCTION_ROADMAP.md Document lessons ADRs E2E test Create Phase 4 planning document

Risk Management Week 3 React Query configuration Review Next.js setup backup start minimal configuration Server action wrapper complexity Start simple pattern iterate usage Integration tests service issues Fix issues Week 4 Weeks 4-6 Feature creep non features CRUD-only scope defer enhancements post-MVP E2E test development Follow Playwright practices retry logic investigate tests Type errors fix Performance degradation features Establish performance baselines Week 3 monitor query times DevTools Timeline Buffers 20% (4 issues refactoring documentation integration testing documentation test suite progress Defer Loyalty Service post-MVP Week 3 Weeks 4-6 strong foundation

Reference Materials Architecture Patterns 4-second rule HORIZONTAL VERTICAL_RESPONSIBILITY layer patterns standards_TYPE_WORKFLOW system management Planning Roadmap 8-week_GAPS gaps technical debt_STEPS_REPORT Phase 2 summary Progress Tracking status weekly updates Documentation navigation map location standardization decision

Start Day 1 2 hours Review_ARCHITECTURE workflow Create ADR-003 template (30 Start React Query (1 Week 3 5 infrastructure (18-20 hours decisions ADR-003 Update SESSION.md Validate quality gates Week 4 Weeks 4-6 feature week 5-layer Track completion E2E tests

Execution Checklist Pre-Phase 3 Review BALANCED_ARCHITECTURE_QUICK.md Read Phase 3 workflow Verify Phase 2 (7 services local environment.js React Query Zustand Week 3 React Query Server action wrapper Zustand stores Hook templates Integration tests ADR-003 finalized Week 4 Player server actions query hooks mutation hooks UI components E2E tests Week 5 server actions query hooks UI components E2E tests Week 6 RatingSlip actions query hooks mutation UI tests Post-Phase 3 3 features delivered SESSION_HANDOFF.md MVP_PRODUCTION_ROADMAP.md Phase 4 planning Lessons learned ADRs

Phase 3 Week management React Query Weeks 4-6 delivery Player Management 5 Visit Tracking 6 RatingSlip MVP 3/3 features >90% E2E test pass <100ms Zero TypeScript errors quality gates 4-second rule TodoWrite weekly ADR-003-004-005 Ready execution Week 3 React Query 4 weeks Development team 2025-10-10
