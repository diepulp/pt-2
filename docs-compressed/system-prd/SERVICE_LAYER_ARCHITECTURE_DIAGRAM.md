Canonical Service

Service Layer Blueprint PT-2 captures service patterns PT-1 anti-patterns Type System Anti-Patterns `ReturnType createXService inference parameters safety Incomplete interfaces casting Object spread without type guards Architectural Anti-Patterns Dual rating-slip Class-based service abstractions Over-engineered ServiceFactory caching class wrappers services Duplicate factory patterns Global state management Global real managers Export/Module Anti-Patterns Mixed default named exports Zero-value wrapper functions Runtime validation factory functions Player Visit Rating Slip Casino MTL Compliance Table Context services PT-1 Client Layer Service Orchestration Core Domain Services Service Module CompositionRY Queries TRN Mapping VAL Module Checks Shared Service Infrastructure Handling SR DTO DTOs VAL Schemas Data Layer SB Client DB Enabled RT-time Connections Client Service UI Hooks SF Actions Service Factory Pattern PS VS RS CS TC MS NS CPS Module Composition Service PS CRUD QRY TRN TRN CRUD BUS QRY TRN

CS CRUD QRY TRN VAL CRUD QRY TRN VAL CRUD QRY TRN VAL Shared Infrastructure Usage CRUD QRY SR TRN DTO VAL_SCH Data Layer Connections CRUD QRY DB RT service#e1f5fe#01579b module#f3e5f5#4a148c#fff3e0 data#e8f5e9#1b5e20 client#fce4ec#880e4f orchestration#f0f4c3#33691e PS CRUD_SCH SB UI SF orchestration

Architectural Patterns Functional Factory Pattern Explicit Interfaces CORRECT Explicit interface type signatures export interface PlayerService getById<ServiceResult searchPlayers create update factory explicit interface export function createPlayerService PlayerService crudService searchService queryService Pure composition no internal state side effects Export explicit type ReturnType PlayerServiceType PlayerService ANTI-PATTERNS AVOID NO BaseService ServiceFactoryexport PlayerService ReturnType createPlayerService(supabase SupabaseClient return incomplete interfaces class wrappers services default exports named exports Operation Wrapper Pattern Standardized error handling result transformation export async function executeOperation<T> Promise<ServiceResult Module Composition service specialized modules Basic database operations Complex workflows Advanced queries DTO mapping data transformation Input validation ServiceResult Pattern ServiceResult<T data error success status timestamp requestId

Domain Player search Identity management Profile validation Visit tracking statistics transition Rating Slip Point calculations Table assignments Status transitions Casino table Floor Game settings Inventory management Chip counts Shift handovers Fill slips MTL Money transaction logging CTR reporting$10k Gaming day calculations Compliance Audit trails Notes Staff Audit logging Witness checks validations Regulatory reporting

Guidelines PT-2 Use factories creation Declare interfaces signatures Type Export types Compose services specialized modules Return `ServiceResult<T> operations `executeOperation wrapper business logic modules DTOs boundaries Validate inputs Enable RLS tables Keep factories pure stateless named exports default Anti class inheritance Create ServiceFactory factory patterns `ReturnType inference parameters type casting bypass interfaces class wrappers Leave methods undeclared interfaces Mix default named exports Add runtime validation functions dev-only assertions zero-value wrapper functions business logic CRUD modules Access Supabase UI Store server data `staleTime 0 React Query real-time managers Mix service type responsibilities Cache instances

Migration Priorities Core infrastructure service error handling Player Visit services Rating Slip Casino Table Context services MTL Compliance services

Performance cleanup-time subscriptions React Query invalidations dynamic imports bundle under 250KB

Type System Integration source import type Database Domain DTOs reference types PlayerDTO Database "id_name Service boundaries use DTOs interface PlayerService getById create

Service Layer Folder Structure shared infrastructure operation-wrapper executeOperation ServiceResult error-handling wrapper types ServiceResult ServiceError utils generateRequestId player domain service index.ts Main factory interface export crud.ts operations module business Business logic module queries Complex queries transforms DTO mapping module validation Zod schemas module visit domain service index crud business queries transforms validation rating-slip Rating Slip domain index crud business queries validation casino Casino domain service index business validation table-context Context domain index crud business validation mtl/Compliance domain index crud business queries transforms validation reports CTR reporting logic notes Notes domain service indexts crud business queries transforms validation.ts compliance Compliance domain index.ts crud.ts business.ts queries.ts transforms.ts validation.ts Module Responsibilities`index.ts Main service factory export interface PlayerService export function createPlayerService export type PlayerServiceType`crud.ts Basic database operations export function createPlayerCrudService getById async create update delete`business.ts Domain workflows orchestration

export createPlayerBusinessService activatePlayer async string deactivatePlayer async executeOperation(...) Complex multi-step operations.ts Advanced queries createPlayerQueriesService searchPlayers async string executeOperation(...) getPlayerStats async string executeOperation(...) Complex read operations.ts DTO mapping data transformation export toPlayerDTO export toPlayerView`validation.ts Zod schemas input validation export playerCreateSchema first last playerUpdateSchema playerCreateSchema.partial Anti-Patterns Avoid/base No class abstractions No factory caching/metrics No global real-time managers No duplicate implementationsTypes/domains/player mixing service logic type definitions file architecture foundation PT-2 patterns PT-1
