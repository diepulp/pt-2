Service Responsibility 2025-10-06 Post-RatingSlip Domain Separation Maintain integrity Casino domains

Executive Summary service owns domain data contexts ID RatingSlip Performance ledger Separation prevents coupling maintains single responsibility

Bounded Context Map` │ CASINO TRACKER SYSTEM │ │ │ │ │ │ │ │ FINANCE │ CONTEXT Player Casino │ │ Player │ Service Financial │ │ │ │ │ │ ▼ ▼ │ │ │ │ SESSION CONTEXT (Aggregate Root) │ │ │ │ │ │ │ Visit RatingSlip │ │ Service │ (Performance)│ │ │ │ │ │ │ │ │ ``` ---

Service Responsibility Matrix Domain Owns References Aggregates Responsibilities `PlayerService Player profile Contact info Identity data Visits RatingSlips Financials Identity `CasinoService Casino details Tables Game configs Visits Venue management `VisitService sessions Check-in/out Visit mode Player Casino RatingSlips Session lifecycle Average bet Time Points Game settings Seat number Gaming Table metrics Cash in/out Chips Transaction history Reconciliation RatingSlip \*\*Financial tracking

Domain Ownership Rules RatingSlip Service (Performance Ledger_bet_time Duration play `points Loyalty points_seconds Time played_settings configuration `seat_number Rating slip lifecycle OWN Cash/chip transactions `PlayerFinancialService Player identity Visit session player perform?" PlayerFinancialService (Financial Ledger `cash_in `chips_brought_taken Ending_type Deposit withdrawal exchange `reconciliation_status Balanced pending_change Computed win/loss_id transaction_id session_slip_id link performance context money/chips moved in/out?" PlayerService (Identity Context `email Identity `loyalty_tier Player classification `preferences Player settings Total visits points Financial history player?" VisitService (Session Context `check_in_date_out_date Session boundaries `modeplayer untracked Visit lifecycle state Rating slips Financial transactions player's session casino?"

Data Flow Diagrams Creating Complete Session Performance Finances Client Create Player PlayerService Returns player_id Create Visit (player_id + casino_id VisitService Returns visit_id 3a. Create 3b. Create RatingSlip Financial Tx RatingSlipSvc PlayerFinancialSvc (Performance) (Money tracking) average_bet cash_in points chips_brought time_played chips_taken Aggregated Session Report Performance metrics Financial summary Visit details Cross-Service Query Pattern "Get player's session summary Client Layer async function getSessionSummary(visitId Get visit details await visitService.getById Get all rating slips visit await Promise.allgetByVisitId Performance playerFinancialService Money Aggregate client/action layer visit performance totalPoints sum(ratingSlips avgBet totalTime.accumulated_seconds financials totalCashIn totalChipsOut.chips_taken netChange calculate Aggregation/action NOT services

Anti-Patterns Avoid Cross-Domain Ownership RatingSlip financial data interface average_bet Performance cash_in Finance domain chips_taken Clear separation interface average_bet Performance cash_in Finance chips Service-to-Service Direct Calls Services calling other RatingSlipService async create(data Service calling service financial Client/action orchestrates async function createSession orchestrates services ratingSlip financial Shared Mutable State Services sharing state globalSessionCache Global state class RatingSlipService create globalSessionCache(data.visitId Mutation Immutable isolated state class RatingSlipService No shared state functions async create

Migration Strategy Phase 1: Current State Player Visit RatingSlip services implemented simplified financial fields contexts clarified Phase 2: PlayerFinancialService Create/player-financial module TABLE player_financial_transaction player cash_in chips_brought transaction_type 'DEPOSIT 'EXCHANGE reconciliation_status 'RECONCILED Implement CRUD Add query methods Phase 3: Integration Update client actions services queries finance UI separate performance financial metrics

Context Validation Checklist adding field verify core responsibility source truth data coupling domain needed MVP scope? Field cash_in Service Checklist Single NO performance not finance Ownership NO owns monetary data Dependencies YES performance finance YAGNI NO needed MVP performance tracking Decision Reject belongs PlayerFinancialService

References Simplification Analysis KISS/YAGNI audit Template Implementation Blueprint Architecture standards Implement `PlayerFinancialService context model
