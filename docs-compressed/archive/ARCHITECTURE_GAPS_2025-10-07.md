Architecture Gap 2025-10-07 Phase 2 Layer 75% (6/8 components

Gap Summary Implemented Foundation explicit interfaces (6/8 complete Player Visit RatingSlip PlayerFinancial Casino TableContext MTL Loyalty post-MVP **Shared-wrapper types utils **Database RLS UUID consistency **JWT audit logging skeleton/CD** quality gates **Testing (Jest Cypress 79 tests passing-pattern (ESLint pre hooks location (ADR-002) Root-level/services context Service Responsibility Matrix **Template velocity\*\* 4x improvement validated (89min Missing Critical Components Status React Query setup Phase 3 stores Server actions layer Domain components Channel wrapper hooks Invalidation scheduler Bundle optimization Query optimization RLS policy completion Phase 4 ComplianceStructured logging Missing Phase 5 Launch Migration automation Missing

Gap Analysis State Management Layer 3 Blocker Services exist no consumption lib query-client.ts React Query config hooks use-service-query.ts Query wrapper template player use-player-queries-player-mutations mutations ratingslip-queries player-store UI state visit-store.ts Modal/nav state React Query defaults `staleTime 0 `refetchOnWindowFocus false Query key pattern Mutations `invalidateQueries `setQueryData restricted ephemeral UI state server data UI layer blocked infrastructure exists Server Actions Layer 3 Blocker Minimal server actions-create only lib/actions-server-action-wrapper.ts Action wrapper player create-player-action update-player-action.ts get-player-actionsearch-players-action start-visit-action end cancel-visit-action create-rating-action update-rating-action mutations server actions Structured telemetry error codes Cache invalidation No console Data fetching/mutations blocked Real-Time Infrastructure 3 Critical No hooks use-supabase-channel Channel wrapper Domain subscriptions invalidation-scheduler Batch invalidation `useSupabaseChannel wrapper Cleanup unmount memory leaks Batch Query invalidations scheduler Domain-specific hooks global managers/table-context/useTableContextRealtime scheduler pattern Real-time updates non-functional UI Component Layer 3 Blocker Minimal UI-form

Domain Components** player player-form.tsx needed player-list.tsx player-detail-search visit-form.tsx-list-detail ratingslip rating-form rating-list-detail casino table-manager.tsx transaction-form compliance-dashboard.tsx Requirements** Server Components data fetching Client Components accept DTO props Dynamic imports heavy components HeroUI/Radix imports No user-facing functionality Performance Infrastructure (Phase 5 Blocker No performance monitoring Components\*\* lib/performance lighthouse-config.ts Budget enforcement bundle-analyzer Size tracking performance Lighthouse CI next.configmjs Bundle analysis LCP 2.5s TBT 200ms Initial JS 250KB Automated Lighthouse CI Performance budgets enforced Observability Logging 5 No structured logging lib/logging logger logger telemetry Metrics collection instrumentation Next.js Structured logging/key-value No console Domain metrics API boundary Alertable events failures Production debugging Security Hardening 4-5 RLS skeleton Policies Player/tests rls-policies.test Policy verification rate-limiting cors-config Least-privilege RLS policies JWT claim validation Audit logging critical actions Zero security advisor warnings Production security compromised

Deployment Operations 5 Blocker Local development deploy-staging-production migrate.sh Migration automation rollback procedures health-check deployment-runbook rollback-playbook incident-response.md Environment flow local dev staging production Migration Supabase CLI Rollback scripts Release gates manual smoke tests Cannot deploy production

Priority Matrix P0 Next Phase Query UI actions Data fetching UI User functionality-time Live updates P1 (Critical MVP Budget enforcement RLS completion Production observability Production readiness P2 (Important Business logic Regulatory requirements E2E validation

Remediation Plan Week 2 Services 75% Casino Service Table Context Service location standardization MTL Service PT-1 search Lock service templates State Management Foundation React Query UI Server action 4 Real-Time Infrastructure invalidation scheduler-time hooks Memory leak 5 UI Player Visit RatingSlip Dynamic import Week 6 Performance Security Lighthouse CI Bundle analysis RLS policy Security advisor audit Week 7 Observability Deployment Structured logging Telemetry Deployment automation Rollback

Architecture Decision Records-Time Scheduler invalidation React Query cache domain Telemetry error handling Bundle splitting RLS policy multi-role access Migration versioning rollback

References_BLUEPRINT_MVP_PRD Architecture requirements_LAYER_ARCHITECTURE_DIAGRAM Service patterns-hybrid-refactor-model Implementation strategy_HANDOFF implementation 2025-10-07 End Week 3 2 Phase 2 75% (6/8 services complete
